{"version":3,"sources":["img/splash.GIF","airtable/airtable.tsx","airtable/config.ts","constants.tsx","components/Cover/Cover.tsx","components/Navbar/Navbar.tsx","icons.tsx","components/Rubric/Rubric.tsx","components/LevelBubble/LevelBubble.tsx","components/Profile/Profile.tsx","components/MarketCard/MarketCard.tsx","components/LessonCard/LessonCard.tsx","App.tsx","airtable/constants.ts","index.tsx"],"names":["module","exports","base","config","endpointUrl","apiKey","apikey","_config","find","recId","listName","a","Promise","resolve","reject","err","record","console","error","fields","recID","id","create","replace","field","update","params","records","log","JSON","parse","catch","delete","recIDs","destroy","options","cells","select","eachPage","fetchNextPage","forEach","el","push","tLOGS","tUSERS","VK_GROUP_ID","Cover","this","props","background","height","className","style","minHeight","children","React","Component","Navar","go","dataTo","osname","platform","IOS","marginTop","left","onClick","data-to","star","fill","width","viewBox","xmlns","d","logo","fillRule","clipRule","Rubric","state","purchases","lessons","activeTab2","parseDate","iso","date","Date","month","getMonth","getDate","getFullYear","toLocaleTimeString","parseHistory","history","map","i","key","asideContent","rubric","description","getLessons","list","view","filterByFormula","then","res","obj","days","0","1","2","3","4","5","6","Time","setHours","getHours","toTimeString","substring","day","getDay","items","getPurchases","user","pursh","filter","renderMeta","sprintData","data","setState","Object","keys","length","e","mode","currentTarget","dataset","h","cellHistory","selected","source","exp","reduce","current","next","title","header","Math","round","value","les","index","expandable","multiline","before","color","data-meta","stringify","size","LevelBubble","action","Profile","fetchedUser","rubrics","market","openSnackbar","snackbar","top","ANDROID","src","photo_200","href","target","rel","item","display","paddingLeft","fontFamily","thumb_photo","MarketCard","price","url","owner_id","vertical","stretched","component","LessonCard","message","sendData","meta","opt","undo","_","checkPermissions","onBackClick","maxWidth","tp","locale","splashLoader","backgroundColor","splash","alt","App","getItems","setLocation","route","connect","send","location","to","parseMeta","activeView","getWallPost","query","sendPromise","method","count","access_token","authToken","v","post","response","text","execute","isLoading","bind","openBase","onStoryChange","subscribe","detail","type","getRubricsFromBase","getUserDataFromBase","sl","toString","percent","slice","layout","onClose","first_name","last_name","desc","activeStory","story","assign","activePanel","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.cd88312d.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/splash.75e96a0e.GIF\";","\nimport * as air from 'airtable';\nimport { AIR_CONFIG } from './config';\n\nclass Airtable extends air {\n\n    private base\n    private _config: any\n\n    constructor(config: any) {\n        super({ endpointUrl: 'https://api.airtable.com', apiKey: config.apikey })\n        this.base = super.base(config.base)\n        this._config = config\n    }\n\n    list(listName: string, options?: { filterByFormula?: string, fields?: Array<string>, sort?: string, view?: string }) {\n        //sort: [{field: \"Имя\", direction: \"desc\" || \"asc\" }]\n        return new Promise<Array<any>>((resolve, reject) => {\n            let cells = []\n            // let opt = { filterByFormula: `{${key}} = \"${value}\"` } //TO-DO: обработу numbers и strings в значении value\n\n            this.base(listName).select(options ? options : {})\n                .eachPage(function page(records, fetchNextPage) {\n                    records\n                        // .filter(record => record.get(key) === value)\n                        .forEach(el => {\n                            el.fields.recID = el.id\n                            cells.push(el.fields)\n                        })\n\n                    // This function (`page`) will get called for each page of records.\n                    fetchNextPage()\n\n                }, function done(err) {\n                    if (err) { console.error(err); reject(err); return; }\n                    resolve(cells)\n                })\n\n        }).catch(console.error)\n\n    }\n\n\n\n    find = async (recId: string, listName: string) =>\n        new Promise<any>((resolve, reject) => {\n            this.base(listName).find(recId, function (err, record) {\n                if (err) { console.error(err); return; }\n                record.fields.recID = record.id\n                resolve(record.fields)\n            })\n        });\n\n    create = async (fields: any, listName: string) =>\n        new Promise<any>((resolve, reject) => {\n            this.base(listName).create(fields, function (err, record) {\n                if (err) { console.error(err); return; }\n                record.fields.recID = record.id\n                resolve(record.fields)\n            })\n        })\n\n    replace = (recID: string, field: any, listName: string) =>\n        new Promise(resolve => {\n\n            this.base(listName)\n                .replace(recID, field, (err, record) => {\n                    if (err) { console.error(err); return; }\n                    record.fields.recID = record.id\n                    resolve(record.fields)\n                })\n        })\n\n    update = (params: Array<{ id: string, fields: any }>, listName: string) =>\n        new Promise((resolve, reject) => {\n            this.base(listName).update(params, (err, records) => {\n                if (err) {\n                    console.log(records)\n                    console.log(JSON.parse(err))\n                    reject(err)\n                }\n                resolve()\n            })\n        }).catch(console.log)\n\n\n    delete = (recIDs: string[], listName: string) =>\n        new Promise((resolve, reject) => {\n            this.base(listName).destroy(recIDs, (err, record) => {\n                if (err) {\n                    console.log(JSON.parse(err))\n                    reject(err)\n                }\n                resolve(recIDs)\n            })\n        })\n\n}\n\n\nexport const base = new Airtable(AIR_CONFIG);\n\n\n","//DEVELOPMENT\n// export const AIR_CONFIG = {\n//     apikey: 'keyCjoy0c7MaRyisi',\n//     base: 'appJJ0nmLtF6XYalJ',\n//     tLOGS: 'Начисления и списания',\n//     tUSERS: 'Участники'\n// }\n\n//PRODUCTION\nexport const AIR_CONFIG = {\n    apikey: 'keyCjoy0c7MaRyisi',\n    base: 'appEXq7BJ3ceoFRtr',\n    tLOGS: 'Начисления и списания',\n    tUSERS: 'Участники'\n}","export const AIRTABLE_APIKEY = 'keyCjoy0c7MaRyisi';\nexport const AIRTABLE_BASE = 'appEXq7BJ3ceoFRtr';\nexport const VK_APP_ID = 7215450; //prod\nexport const VK_GROUP_ID = 120547095; \nexport const VK_ADMIN_ACCESS_TOKEN = '25bec7da203afb629e05ec40bb284d3f196a85c0a0539b7cb428717a6a24782f883bd139e721167c775f3';\nexport const VK_SERVISE_KEY = 'f60c2422f60c2422f60c242263f6623d78ff60cf60c2422abd8f8acb1ae9af95c999324'//prod\n\n\n\nexport const AMOUNT_TO_NEW_USER = 25;","import React from 'react';\nimport { Div } from '@vkontakte/vkui'\nimport './Cover.css'\n\nexport default class Cover extends React.Component<any, any> {\n\n\n    render() {\n\n        const {\n            background,\n            height\n        } = this.props\n        return (\n            <Div className=\"cover\" style={{ height: height ? height : '38vh', minHeight: '38vh', background: background ? background : 'linear-gradient(200.98deg, #485563 -13.11%, #29323C 75.28%)' }}>\n                {/* {(() => content)()} */}\n                <div className=\"coverContainer\">{this.props.children}</div>\n            </Div>\n        )\n    }\n}\n\n","import React from 'react'\nimport { PanelHeader, platform, IOS, PanelHeaderBack } from \"@vkontakte/vkui\";\n\n\nexport default class Navar extends React.Component<any, any> {\n    render() {\n        let { go, dataTo } = this.props\n        const osname = platform();\n    \n        return (<PanelHeader className=\"navBar\" style={(() => osname === IOS ? {} : { marginTop: '81px' })()} left={<PanelHeaderBack onClick={go} data-to={dataTo} />}>{this.props.children}</PanelHeader>)\n    }\n}","import React from 'react';\n\nexport const star = (fill: string) => <svg width=\"24\" height=\"22\" viewBox=\"0 0 24 22\" xmlns=\"http://www.w3.org/2000/svg\" fill={fill}>\n<path d=\"M12 0L14.8214 8.11672L23.4127 8.2918L16.5651 13.4833L19.0534 21.7082L12 16.8L4.94658 21.7082L7.43493 13.4833L0.587322 8.2918L9.17863 8.11672L12 0Z\" />\n</svg>;\n\nexport const logo = <svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M15.2 2.6636L7.93161 18.2513H11.033C12.0258 18.2513 12.012 19.799 10.9916 19.799H6.74475C6.12427 19.799 5.8485 19.1496 6.0829 18.6383C6.26215 18.2582 6.43796 17.8782 6.61376 17.4982C6.78956 17.1182 6.96537 16.7382 7.14462 16.3581C9.61277 11.024 12.0671 5.70377 14.5215 0.383494L14.5215 0.383475C14.7559 -0.127825 15.6246 -0.127825 15.859 0.383475C16.0382 0.763482 16.214 1.14349 16.3898 1.5235C16.5656 1.90353 16.7414 2.28356 16.9207 2.6636C18.5971 6.29748 20.2799 9.93137 21.9648 13.5697C22.7467 15.2581 23.529 16.9475 24.3114 18.6383C24.5596 19.1496 24.27 19.799 23.6495 19.799H16.0244V23.2538C16.0244 24.2487 14.4801 24.2487 14.4801 23.2538V19.0252C14.4801 18.6106 14.8386 18.2513 15.2523 18.2513H22.4614L15.2 2.6636ZM24.4 1.4C24.4 0.626843 23.7731 1.11759e-08 23 1.11759e-08C22.2268 1.11759e-08 21.6 0.626843 21.6 1.4C21.6 2.17316 22.2268 2.8 23 2.8C23.7731 2.8 24.4 2.17316 24.4 1.4Z\" fill=\"white\" />\n</svg>","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, Div, Group, List, Cell, InfoRow, Progress, Header, Spinner, Tabs, TabsItem } from '@vkontakte/vkui';\nimport { base } from '../../airtable/airtable';\n\nimport \"./Rubric.css\";\nimport Cover from '../Cover/Cover';\nimport ReactMarkdown from 'react-markdown';\n// import connect from '@vkontakte/vk-connect';\nimport Navbar from '../Navbar/Navbar';\nimport { star } from '../../icons';\n// const osname = platform();\n\n\nclass Rubric extends React.Component<any, any> {\n\n\n\tstate = {\n\t\tpurchases: null,\n\t\tlessons: null,\n\t\tactiveTab2: 'desc',\n\t}\n\n\n\n\tasync componentDidMount() {\n\t\tawait this.getPurchases()\n\t\t\t.then(data => {\n\t\t\t\tthis.setState({ purchases: data });\n\t\t\t\treturn\n\t\t\t})\n\n\t\tawait this.getLessons().then(data => {\n\n\t\t\tif (Object.keys(data).length !== 0) {\n\t\t\t\tthis.setState({ activeTab2: 'schedule' })\n\t\t\t}\n\t\t\tthis.setState({ lessons: data });\n\n\t\t\treturn\n\t\t})\n\t}\n\n\n\tcomponentWillUnmount() {\n\t\tthis.setState({ purchases: null, lessons: null })\n\t}\n\n\tselect(e) {\n\t\tconst mode = e.currentTarget.dataset.mode;\n\t\tthis.setState({ mode });\n\t}\n\n\tparseDate = (iso: string) => {\n\t\tvar arr = [\n\t\t\t'января',\n\t\t\t'февраля',\n\t\t\t'марта',\n\t\t\t'апреля',\n\t\t\t'мая',\n\t\t\t'июня',\n\t\t\t'июля',\n\t\t\t'августа',\n\t\t\t'сентября',\n\t\t\t'октября',\n\t\t\t'ноября',\n\t\t\t'декабря',\n\t\t];\n\t\tlet date = new Date(iso)\n\t\tlet month = arr[+date.getMonth()];\n\t\tconst result = `${date.getDate()} ${month} ${date.getFullYear()}, ${date.toLocaleTimeString().replace(/(.*:.*?):\\d+/gs, '$1')}`\n\t\treturn result\n\t}\n\n\tprivate parseHistory = (history: any[]) => {\n\n\t\treturn history.map((el, i) => {\n\t\t\treturn <Cell key={i} asideContent={el.rubric} className={(() => (el['Баллы']) < 0 ? \"cellNegative\" : \"historyCell\")()} description={(() => {\n\t\t\t\treturn this.parseDate(el['Датавремя'])\n\t\t\t})()\n\t\t\t} >\n\n\t\t\t\t{(() => {\n\n\t\t\t\t\tif (!el['Баллы']) el['Баллы'] = 0;\n\n\t\t\t\t\tif (el['Баллы'] > 0 && el['Опыт']) {\n\t\t\t\t\t\treturn <span><span>{el['Баллы']}</span><span className=\"star\">{star('#000000')}</span><span>,&nbsp;{el['Опыт'][0]}&nbsp;опыта {(() => el['Комментарий'] ? \"• \" + el['Комментарий'] : \"\")()}</span></span>\n\t\t\t\t\t} else if (el['Баллы'] === 0 && el['Опыт']) {\n\t\t\t\t\t\treturn <span>{el['Опыт'][0]}&nbsp;опыта {(() => el['Комментарий'] ? \"• \" + el['Комментарий'] : \"\")()}</span>\n\n\t\t\t\t\t} else if (!el['Опыт']) {\n\t\t\t\t\t\treturn <span><span>{el['Баллы']}</span><span className=\"star\">{star('#000000')}</span>{(() => el['Комментарий'] ? \"• \" + el['Комментарий'] : \"\")()}</span>\n\n\t\t\t\t\t}\n\t\t\t\t})()\n\t\t\t\t}\n\n\t\t\t</Cell>\n\t\t})\n\t}\n\n\n\tgetLessons = async () => {\n\t\tif (!this.props.rubric) return;\n\n\t\treturn base.list('Тренировки', { view: 'Ближайшие', filterByFormula: `AND(NOT({Дата}=BLANK()), {RubricID}='${this.props.rubric.recID}')` })\n\t\t\t.then((res: any[]) => {\n\t\t\t\tlet obj = {}\n\n\n\t\t\t\tconst days = {\n\t\t\t\t\t0: 'вс',\n\t\t\t\t\t1: 'пн',\n\t\t\t\t\t2: 'вт',\n\t\t\t\t\t3: 'ср',\n\t\t\t\t\t4: 'чт',\n\t\t\t\t\t5: 'пт',\n\t\t\t\t\t6: 'сб'\n\t\t\t\t}\n\n\t\t\t\tres.forEach(el => {\n\t\t\t\t\tlet key = this.parseDate(el['Дата']).replace(/^(\\d+\\s.+?)\\s.+/gs, '$1');\n\t\t\t\t\tlet date = new Date(el['Дата']);\n\n\t\t\t\t\tobj[key] = {\n\t\t\t\t\t\tdate: key,\n\t\t\t\t\t\tday: days[date.getDay()],\n\t\t\t\t\t\titems: []\n\t\t\t\t\t}\n\n\n\t\t\t\t})\n\n\t\t\t\tfunction Time(date) {\n\t\t\t\t\tvar d = new Date(date);\n\t\t\t\t\td.setHours(d.getHours());\n\t\t\t\t\tlet res = d.toTimeString().substring(0, 5);\n\t\t\t\t\treturn res;\n\n\t\t\t\t}\n\n\n\t\t\t\tres.forEach(el => {\n\t\t\t\t\tlet key = this.parseDate(el['Дата']).replace(/^(\\d+\\s.+?)\\s.+/gs, '$1');\n\t\t\t\t\tel['День недели'] = days[new Date(el['Дата']).getDay()]\n\t\t\t\t\tel['Время'] = Time(el['Дата'])\n\t\t\t\t\tel['Окончание'] = Time(el['Время окончания'])\n\t\t\t\t\tel['Дата'] = key;\n\t\t\t\t\tel['rubric'] = this.props.rubric;\n\t\t\t\t\tobj[key]['items'].push(el)\n\t\t\t\t})\n\n\n\t\t\t\treturn obj\n\t\t\t})\n\t}\n\n\tgetPurchases = async () => {\n\t\tconst user = this.props.user;\n\t\tconst rubric = this.props.rubric;\n\t\tlet res = await base.list('Покупки', { filterByFormula: `AND({VK-ID}=${user.id}, {Статус}=BLANK() )`, fields: [\"Рубрика\", \"Осталось\", \"Датавремя\", \"Кол-во тренировок\", \"Посещеные тренировки\"] }).catch(err => {\n\t\t\tconsole.log(err);\n\t\t\treturn [];\n\t\t}) as [];\n\n\t\tlet pursh = res.filter(el => el['Осталось'] && el['Рубрика'] && el['Рубрика'][0] === rubric.recID)\n\t\treturn pursh[0];\n\t}\n\n\n\trenderMeta = (el) => {\n\t\tel.sprintData = this.props.sprintData\n\t\tel.purchases = this.state.purchases\n\t\treturn el\n\t}\n\n\trender() {\n\n\t\tlet {\n\t\t\tgo,\n\t\t\trubric,\n\t\t\thistory\n\t\t\t// sprintData\n\t\t} = this.props\n\n\t\tlet h = history ? history.filter(el => el.rubric === rubric['Название']) : []\n\t\t// if(!this.state.purchases) return splashLoader;\n\n\n\n\t\tlet cellHistory = this.parseHistory(h);\n\n\n\n\t\tconst cover = () => rubric['Обложка'] ? `url(${rubric['Обложка'][0]['url']}) center/cover no-repeat` : '';\n\t\t\n\t\treturn (\n\n\t\t\t<Panel id='rubric'>\n\n\t\t\t\t<Navbar go={go} dataTo='profile'></Navbar>\n\n\t\t\t\t<Cover background={cover()} height=\"fit-content\">\n\t\t\t\t\t<Div className=\"desc\">\n\t\t\t\t\t\t<h1>{rubric['Название']}</h1>\n\t\t\t\t\t\t<div className=\"lead\">{(() => { return this.state.purchases ? `Ваш абонемент: ${this.state.purchases['Осталось']} тренировка` : \"\" })()}</div>\n\t\t\t\t\t\t{/* <ReactMarkdown source={ \"\" } /> */}\n\t\t\t\t\t</Div>\n\t\t\t\t</Cover>\n\n\t\t\t\t{\n\t\t\t\t\t(() => {\n\t\t\t\t\t\t//выводим список тренировок\n\t\t\t\t\t\tif (!this.state.lessons) return <Spinner size=\"medium\" style={{ marginTop: 20 }} />\n\n\n\t\t\t\t\t\treturn <div><Tabs>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\t\t\tif (!rubric['Тренировки']) return\n\n\t\t\t\t\t\t\t\t\treturn <TabsItem\n\t\t\t\t\t\t\t\t\t\tonClick={() => this.setState({ activeTab2: 'schedule' })}\n\t\t\t\t\t\t\t\t\t\tselected={this.state.activeTab2 === 'schedule'}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tРасписание\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</TabsItem>\n\t\t\t\t\t\t\t\t})()\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\t\t\tif (!rubric['Описание']) return\n\n\t\t\t\t\t\t\t\t\treturn <TabsItem\n\t\t\t\t\t\t\t\t\t\tonClick={() => this.setState({ activeTab2: 'desc' })}\n\t\t\t\t\t\t\t\t\t\tselected={this.state.activeTab2 === 'desc'}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tОписание\n\t\t\t\t\t\t\t\t\t\t\t\t</TabsItem>\n\t\t\t\t\t\t\t\t})()\n\t\t\t\t\t\t\t}\n\n\n\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\t\t\tif (!h || h.length === 0) return\n\n\t\t\t\t\t\t\t\t\treturn <TabsItem\n\t\t\t\t\t\t\t\t\t\tonClick={() => this.setState({ activeTab2: 'history' })}\n\t\t\t\t\t\t\t\t\t\tselected={this.state.activeTab2 === 'history'}\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tПрогресс\n\t\t\t\t\t\t\t\t\t\t\t\t</TabsItem>\n\t\t\t\t\t\t\t\t})()\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t</Tabs>\n\n\n\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\tif (this.state.activeTab2 !== 'desc' || !rubric['Описание']) return;\n\t\t\t\t\t\t\t\treturn <Div><ReactMarkdown source={rubric['Описание']} /> </Div>\n\t\t\t\t\t\t\t})()\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t//прогресс бар по рубрике\n\t\t\t\t\t\t\t\tif (this.state.activeTab2 !== 'history' || !rubric['Итог опыт']) return;\n\n\t\t\t\t\t\t\t\tlet exp = h.filter(el => el['Опыт']).map(el => el['Опыт'][0])\n\t\t\t\t\t\t\t\t\t.reduce((current, next) => current + next);\n\t\t\t\t\t\t\t\treturn <Group title=\"Прогресс\" className=\"progressBarContainer\">\n\t\t\t\t\t\t\t\t\t<InfoRow header={`${Math.round((exp * 100) / rubric['Итог опыт'])}%`} className=\"progressBar\">\n\t\t\t\t\t\t\t\t\t\t<Progress value={(exp * 100) / rubric['Итог опыт']} style={{ width: '100%' }} />\n\t\t\t\t\t\t\t\t\t</InfoRow>\n\t\t\t\t\t\t\t\t</Group>\n\n\t\t\t\t\t\t\t})()}\n\n\n\t\t\t\t\t\t\t{(() => {\n\n\t\t\t\t\t\t\t\tif (this.state.activeTab2 !== 'history' || h.length === 0) return;\n\n\t\t\t\t\t\t\t\t//Выводим историю начислений по этой рубрике\n\t\t\t\t\t\t\t\treturn <Group header={<Header mode=\"secondary\">История</Header>} className=\"history\">\n\t\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\t\tif (h.length === 0) {\n\t\t\t\t\t\t\t\t\t\t\treturn <Div>Вы пока не участвовали ни в одной активности в этой рубрике.</Div>\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\treturn <List> {cellHistory} </List>\n\t\t\t\t\t\t\t\t\t})()}\n\n\t\t\t\t\t\t\t\t</Group>\n\t\t\t\t\t\t\t})()}\n\n\n\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\tif (this.state.activeTab2 !== 'schedule') return;\n\n\t\t\t\t\t\t\t\tconst lessons = this.state.lessons;\n\t\t\t\t\t\t\t\tlet days = Object.keys(lessons);\n\t\t\t\t\t\t\t\treturn days.map((key, i) => {\n\t\t\t\t\t\t\t\t\tlet les = lessons[key];\n\t\t\t\t\t\t\t\t\treturn <div className=\"calendarWrapper\" key={i}>\n\t\t\t\t\t\t\t\t\t\t<Group header={<h1 className=\"calendarHeader\">{key.replace(/(\\d+\\s\\D{3}?).+/gs, '$1') + \", \" + les['day']}</h1>}  >\n\t\t\t\t\t\t\t\t\t\t\t{(() => {\n\t\t\t\t\t\t\t\t\t\t\t\treturn lessons[key]['items'].map((el, index) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Cell expandable multiline onClick={go} data-to='lesson' before={<div className=\"time\">{el['Время']}<br /><span style={{ color: \"#cccccc\" }}>{el['Окончание']}  <br /> МСК</span></div>} data-meta={JSON.stringify(this.renderMeta(el))} key={index} description={el['Описание'].substring(0, 70)}>{el['Name']}</Cell>\n\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t\t\t\t\t</Group>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\t})()}\n\t\t\t\t\t\t</div>\n\n\n\n\t\t\t\t\t})()\n\t\t\t\t}\n\n\n\n\n\n\n\n\n\t\t\t</Panel>\n\n\t\t);\n\t}\n}\n\nRubric.propTypes = {\n\tid: PropTypes.string.isRequired,\n\tpost: PropTypes.object,\n\tuser: PropTypes.shape({\n\t\tphoto_200: PropTypes.string,\n\t\tfirst_name: PropTypes.string,\n\t\tlast_name: PropTypes.string,\n\t\tcity: PropTypes.shape({\n\t\t\ttitle: PropTypes.string,\n\t\t}),\n\t}),\n};\n\nexport default Rubric;","import React from 'react';\nimport './LevelBubble.css'\n\nexport default class LevelBubble extends React.Component<any, any> {\n    render() {\n\n        let {\n            action\n        } = this.props\n\n        return (\n            <div className=\"levelBubble\" onClick={action}>{this.props.children}</div>\n        )\n    }\n}","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, Cell, List, PanelHeader, Group, Avatar, HorizontalScroll, platform, ANDROID } from '@vkontakte/vkui';\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward';\nimport \"./Profile.css\";\nimport Cover from '../Cover/Cover';\nimport { star, logo } from '../../icons';\nimport LevelBubble from '../LevelBubble/LevelBubble';\n\n\n\n\n\n\nclass Profile extends React.Component<any, any> {\n\n  \n\n    private parseHistory = (history: any[]) => {\n\n        const parseDate = (iso: string) => {\n            var arr = [\n                'января',\n                'февраля',\n                'марта',\n                'апреля',\n                'мая',\n                'июня',\n                'июля',\n                'августа',\n                'сентября',\n                'октября',\n                'ноября',\n                'декабря',\n            ];\n            let date = new Date(iso)\n            let month = arr[+date.getMonth()];\n            const result = `${date.getDate()} ${month} ${date.getFullYear()}, ${date.toLocaleTimeString().replace(/(.*:.*?):\\d+/gs, '$1')}`\n            return result\n        }\n\n\n        return history.map((el, i) => {\n            return <Cell key={i} asideContent={el.rubric} className={(() => (el['Баллы']) < 0 ? \"cellNegative\" : \"historyCell\")()} description={(() => {\n                return parseDate(el['Датавремя'])\n            })()\n            } ><span>{el['Баллы']}</span><span className=\"star\">{star('#000000')}</span>\n\n            </Cell>\n        })\n    }\n\n\n    \n\n\n\n    render() {\n       \n\n\n        let {\n            fetchedUser,\n            sprintData,\n            history,\n            go,\n            rubrics,\n            market,\n            openSnackbar,\n            snackbar\n        } = this.props\n        \n        let cellHistory = this.parseHistory(history)\n        \n        return (\n           \n            <Panel id='profile'  >\n                <PanelHeader></PanelHeader>\n\n                <Cover fetchedUser={fetchedUser} sprintData={sprintData} height=\"184px\">\n                    <div className=\"logo\" style={{ top: (platform() === ANDROID) ? '25px' : '37px' }}>{logo}</div>\n                    <div className=\"amountContainer\">\n                        <Avatar src={fetchedUser.photo_200} size={72}></Avatar>\n                        <div className=\"amountWrapper\">\n                            <span className=\"amount\">{sprintData['Баланс']}</span>\n                            <span className=\"star\">{star('#ffffff')}</span>\n                            <br />\n                            <a href=\"https://vk.com/@lean.school-kak-zarabotat-v-line-bally-i-zachem\" target=\"_blank\" rel=\"noopener noreferrer\">Как и зачем зарабатывать баллы?</a>\n                            <LevelBubble className=\"levelBubble\" action={openSnackbar}>{Math.round(sprintData['Уровень'])}</LevelBubble>\n                        </div>\n\n                    </div>\n                </Cover>\n\n                \n\n                <Group title=\"Рубрики\" >\n                    <List>\n                        {(() => rubrics\n                            .map((item, i) => {\n                                let cover = () => item['Обложка'] ? <Avatar mode=\"image\" src={item['Обложка'][0]['url']} size={72} /> : \"\"\n                                return (<Cell key={i} before={cover()} multiline description={item['desc']} asideContent={<Icon24BrowserForward fill=\"var(--icon_secondary)\" />} onClick={go} data-to='rubric' data-meta={JSON.stringify(item)}>{item['Название']}</Cell>)\n                            })\n                        )()}\n                    </List>\n                </Group>\n\n                <Group title='Товары за баллы'>\n                    <HorizontalScroll>\n                        <div style={{ display: 'flex', paddingLeft: '12px', fontFamily: 'Montserrat' }}>\n\n                            {\n                                market.length > 0 && market.map((item, i) =>\n                                    (<div key={i} className=\"marketItem\">\n                                        <Avatar className=\"marketImage\" mode=\"image\" key={i} src={item.thumb_photo} onClick={go} data-to='marketItem' data-meta={JSON.stringify(item)} />\n                                        {item.title.replace(/(\\d+★).*/gs, '$1')}</div>)\n                                )\n                            }\n\n\n                        </div>\n                    </HorizontalScroll>\n\n\n                </Group>\n\n\n                {(() => {\n                    if (cellHistory.length !== 0) {\n                        return (\n                            <Group title=\"История\" className=\"history\"><List> {cellHistory} </List></Group>)\n                    }\n                })()}\n\n                {snackbar}\n            </Panel>\n            \n        );\n    }\n}\n\nProfile.propTypes = {\n    id: PropTypes.string.isRequired,\n    sprintData: PropTypes.object,\n    rubrics: PropTypes.array,\n    history: PropTypes.array,\n    go: PropTypes.func,\n    market: PropTypes.array,\n    fetchedUser: PropTypes.shape({\n        photo_200: PropTypes.string,\n        first_name: PropTypes.string,\n        last_name: PropTypes.string,\n        city: PropTypes.shape({\n            title: PropTypes.string,\n        }),\n    }),\n};\n\nexport default Profile;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, Div, FixedLayout, Button, } from '@vkontakte/vkui';\nimport Cover from '../Cover/Cover';\nimport \"./MarketCard.css\";\nimport Linkify from 'react-linkify';\nimport Navbar from '../Navbar/Navbar';\n\n\n\n\n\n\n\nclass MarketCard extends React.Component<any, any> {\n\n\n    render() {\n\n        let {\n            item,\n            id,\n            go\n        } = this.props\n\n\n\n        const title = item.title.replace(/\\d+★\\s/gm, '');\n        const price = item.title.replace(/(\\d+)★\\s.*/gm, '$1');\n        const url = `https://vk.com/market${item.owner_id}_${item.id}`\n        return (\n\n            <Panel id={id} className=\"marketCard\">\n                <Navbar go={go} dataTo='profile'></Navbar>\n                <Cover height=\"auto\"><h1>{title}</h1>{price} ★</Cover>\n                <Div className=\"desc\">\n                    <Linkify>\n                        {item.description}\n                    </Linkify>\n                    \n                </Div>\n                <FixedLayout className=\"bottomBar\" vertical=\"bottom\">\n                    <Button size={'l'} stretched={true} component=\"a\" href={url} >Открыть в магазине</Button>\n                </FixedLayout>\n            </Panel>\n\n        );\n    }\n}\n\nMarketCard.propTypes = {\n    id: PropTypes.string.isRequired,\n    // item: PropTypes.object.isRequired,\n    fetchedUser: PropTypes.shape({\n        photo_200: PropTypes.string,\n        first_name: PropTypes.string,\n        last_name: PropTypes.string,\n        city: PropTypes.shape({\n            title: PropTypes.string,\n        }),\n    }),\n};\n\nexport default MarketCard;","import React from 'react';\nimport PropTypes from 'prop-types';\nimport { Panel, PanelHeaderBack, PanelHeader, Div, FixedLayout, Separator, Button, Link } from '@vkontakte/vkui';\nimport \"./LessonCard.css\";\nimport Cover from '../Cover/Cover';\nimport ReactMarkdown from 'react-markdown';\nimport { base } from '../../airtable/airtable';\n\n\n\nclass LessonCard extends React.Component<any, any> {\n\n\tstate = { message: null }\n\n\tcomponentDidMount() {\n\t\tthis.checkPermissions()\n\t}\n\n\n\tsendData = async () => {\n\t\tlet data = this.props.meta;\n\t\tlet opt = {\n\t\t\t\"Профиль\": [data.sprintData.recID],\n\t\t\t\"Баллы\": 1,\n\t\t\t\"Рубрика\": data['Рубрика'],\n\t\t\t\"Комментарий\": \"Запись на тренировку\",\n\t\t\t\"Покупки\": [data.purchases.recID],\n\t\t\t\"Тренировка\": [data.recID]\n\t\t}\n\n\t\tawait base.create(opt, data.rubric['Таблица']).then(res => this.setState({\n\t\t\tmessage: (() => {\n\t\t\t\treturn <div>Вы записаны <Link onClick={() => this.undo(res, data.rubric['Таблица'])}>Отменить</Link></div>\n\t\t\t})()\n\t\t})).catch(_ => this.setState({\n\t\t\tmessage: (() => {\n\t\t\t\treturn <div>Что-то сломалось. Напишите мне на <a href=\"mailto:reva@leandesign.pro\">reva@leandesign.pro</a></div>\n\t\t\t})()\n\t\t}))\n\t}\n\n\tundo = (obj, listName) => { base.delete([obj.recID], listName).then(res => this.setState({ message: null })).catch(console.log) }\n\n\n\tcheckPermissions = () => {\n\t\tlet data = this.props.meta;\n\t\t//есть ли у него абонемент?\n\t\tlet purchase = data.purchases;\n\n\t\tif (!purchase) return this.setState({ message: 'Для участия нужен абонемент' });\n\n\t\tif (!data['Участники']) return this.setState({ message: null })\n\n\t\tif (data['Осталось'] === 0) return this.setState({ message: 'Не осталось мест на тренировке' })\n\n\t\tif (data['Участники'].find(el => +el === data.sprintData['VK-ID'])) return this.setState({ message: 'Вы записаны' })\n\n\n\t}\n\n\n\n\n\n\trender() {\n\n\t\tlet {\n\t\t\tonBackClick,\n\t\t\tmeta,\n\t\t} = this.props\n\n\n\t\treturn (\n\n\t\t\t<Panel id='lesson'>\n\t\t\t\t<PanelHeader left={<PanelHeaderBack onClick={onBackClick} data-to=\"rubric\" data-meta={JSON.stringify(meta['rubric'])} />}></PanelHeader>\n\t\t\t\t<Cover background=\"#e03800\" >\n\t\t\t\t\t<Div style={{ maxWidth: '62vw' }}>\n\t\t\t\t\t\t<h2>{meta['Name']}</h2>\n\t\t\t\t\t\t<div className=\"lead\">{`${meta['Дата']}, ${meta['День недели']}`} <br />\n\t\t\t\t\t\t\t{meta['Время']}–{meta['Окончание']} МСК</div>\n\t\t\t\t\t</Div>\n\t\t\t\t</Cover>\n\t\t\t\t<Separator />\n\t\t\t\t<Div>\n\t\t\t\t\t<ReactMarkdown source={meta['Описание']} />\n\t\t\t\t</Div>\n\t\t\t\t<FixedLayout vertical=\"bottom\" className=\"bottomBar\">\n\t\t\t\t\t{\n\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\tif (this.state.message) return <Div className=\"lead\">{this.state.message}</Div>\n\t\t\t\t\t\t\treturn <Button size={'l'} stretched={true} onClick={() => this.sendData()}>Записаться</Button>\n\n\t\t\t\t\t\t})()\n\t\t\t\t\t}\n\n\t\t\t\t</FixedLayout>\n\t\t\t</Panel>\n\n\t\t);\n\t}\n}\n\nLessonCard.propTypes = {\n\tid: PropTypes.string.isRequired,\n};\n\nexport default LessonCard;","import React from 'react';\nimport connect from '@vkontakte/vk-connect';\nimport { platform, ANDROID, View, Snackbar, InfoRow, Progress } from '@vkontakte/vkui';\n\nimport { base } from './airtable/airtable';\nimport { R_VK_ID } from './airtable/constants';\n\nimport splash from './img/splash.GIF';\nimport '@vkontakte/vkui/dist/vkui.css';\nimport \"./main.css\";\n\nimport { VK_GROUP_ID, AMOUNT_TO_NEW_USER } from './constants';\nimport Rubric from './components/Rubric/Rubric';\nimport Profile from './components/Profile/Profile';\nimport MarketCard from './components/MarketCard/MarketCard';\nimport LessonCard from './components/LessonCard/LessonCard';\nimport * as Typograf from 'typograf';\n\n\nconst tp = new Typograf({ locale: ['ru', 'en-US'] });\n\nconst splashLoader = <div style={{ width: '100%', height: '100%', backgroundColor: '#770EFD' }}><img src={splash} style={{ width: '100%', height: '100%' }} alt=\"loading...\" /></div>;\n\nconst osname = platform();\n\n\nclass App extends React.Component<any, any> {\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\t\tthis.state = {\n\t\t\tfetchedUser: null,\n\t\t\tactiveView: 'profile',\n\t\t\tauthToken: null,\n\t\t\tisLoading: false,\n\t\t\titems: [],\n\t\t\thistory: [],\n\t\t\trubrics: [],\n\t\t\tsprintData: null,\n\t\t\tmeta: {},\n\t\t\tsnackbar: null,\n\t\t\tpurchases: null\n\n\t\t};\n\n\t\t\n\t\tthis.getItems = this.getItems.bind(this);\n\t\tthis.openBase = this.openBase.bind(this);\n\t\tthis.onStoryChange = this.onStoryChange.bind(this);\n\n\t}\n\n\tasync componentDidMount() {\n\t\t\n\t\tthis.setState({ isLoading: true });\n\n\t\tconnect.subscribe(async (e: any) => {\n\t\t\tswitch (e.detail.type) {\n\t\t\t\tcase 'VKWebAppGetUserInfoResult':\n\t\t\t\t\tthis.setState({ fetchedUser: e.detail.data });\n\t\t\t\t\tthis.setState({ rubrics: await this.getRubricsFromBase() })\n\t\t\t\t\tthis.setState({ sprintData: await this.getUserDataFromBase() })\n\t\t\t\t\tthis.setState({ isLoading: false })\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'VKWebAppAccessTokenReceived':\n\t\t\t\t\tthis.setState({ authToken: e.detail.data.access_token });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'VKWebAppViewRestore':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\n\t\t\t}\n\t\t});\n\n\n\n\n\t\t(osname === ANDROID) ? connect.send(\"VKWebAppSetViewSettings\", { \"status_bar_style\": \"light\", \"action_bar_color\": \"#000000\" }) : connect.send(\"VKWebAppSetViewSettings\", { \"status_bar_style\": \"light\", });\n\t\tconnect.send('VKWebAppGetUserInfo', {});\n\t\t// connect.sendPromise(\"VKWebAppGetAuthToken\", { \"app_id\": VK_APP_ID, \"scope\": \"market\" });\n\n\t}\n\n\n\n\n\topenBase() {\n\n\t\tif (this.state.snackbar) return;\n\n\t\tlet exp = this.state.sprintData['Опыт'];\n\t\tlet sl = exp.toString()\n\t\tlet percent = (sl.length > 3) ? +sl.slice(sl.length - 3) : +sl\n\t\tthis.setState({\n\t\t\tsnackbar:\n\t\t\t\t<Snackbar\n\t\t\t\t\tclassName=\"snackbar\"\n\t\t\t\t\tlayout=\"vertical\"\n\t\t\t\t\tonClose={() => {\n\t\t\t\t\t\tthis.setState({ snackbar: null })\n\t\t\t\t\t\treturn {}\n\t\t\t\t\t}}\n\t\t\t\t>\n\t\t\t\t\t<InfoRow header={`${percent} / 1000 ед. опыта`}>\n\t\t\t\t\t\t<Progress value={percent * 0.1} style={{ width: '100%' }} />\n\t\t\t\t\t</InfoRow>\n\t\t\t\t\t<a href=\"https://vk.com/@lean.school-user-level\" target=\"_blank\" rel=\"noopener noreferrer\">Зачем нужен уровень?</a>\n\n\t\t\t\t</Snackbar>\n\t\t});\n\t}\n\n\tasync getUserDataFromBase() {\n\t\tif (!this.state.fetchedUser) return\n\t\tlet user = this.state.fetchedUser;\n\t\t//получаем данные пользователя из Airtable\n\t\tlet sprintData = await base.list('Участники', { filterByFormula: `{${R_VK_ID}} = ${user.id}` }).then(res => res[0]);\n\n\t\tif (!sprintData) { //если нет, то создаём пользователя в Airtable\n\t\t\tsprintData = await base.create({ 'Имя': `${user.first_name} ${user.last_name}`, [R_VK_ID]: user.id }, 'Участники')\n\t\t\t\t.then(res => base.create({\n\t\t\t\t\t\"Баллы\": AMOUNT_TO_NEW_USER,\n\t\t\t\t\t\"Профиль\": [res.recID],\n\t\t\t\t\t\"Комментарий\": \"Первое начисление\"\n\t\t\t\t}, \"Начисления: разминки\"))\n\n\t\t}\n\n\n\t\treturn sprintData\n\t}\n\n\tasync getRubricsFromBase() {\n\t\tlet rubrics = await base.list('Рубрики', {filterByFormula: '{Опубликовано} = TRUE()'}).catch(e => []) as any[]\n\n\t\treturn rubrics.map(obj => {\n\t\t\tif (obj['Описание']) {\n\t\t\t\tobj['Описание'] = tp.execute(obj['Описание']);\n\t\t\t\tobj.desc = obj['Описание'].replace(/[*#|]/gs, '').slice(0, 60)\n\t\t\t\tif (obj.desc.length < obj['Описание'].length) obj.desc = obj.desc + \"…\"\n\t\t\t}\n\n\t\t\treturn obj\n\t\t})\n\t}\n\n\tgetItems = async () => {\n\n\n\t\t// if (this.state.authToken) {\n\t\t// \tlet market = await this.callVKApi('market.get', { owner_id: -(VK_GROUP_ID), access_token: this.state.authToken })\n\t\t// \t\t.then((res: any) => res.response.items)\n\t\t// \t\t.catch(_ => [])\n\n\t\t// \tthis.setState({ items: market })\n\t\t// }\n\n\n\n\t\t// if (this.state.fetchedUser) {\n\n\n\t\t// let promises = RUBRICS\n\t\t// \t.map(el =>\n\t\t// \t\tbase.list(el, { filterByFormula: `{${R_VK_ID}} = ${this.state.fetchedUser.id}`, sort: [{ field: 'Датавремя', direction: 'desc' }], maxRecords: 10 })\n\t\t// \t\t\t.then(res => res.map(obj => {\n\t\t// \t\t\t\tobj.rubric = el;\n\t\t// \t\t\t\treturn obj;\n\t\t// \t\t\t}))\n\t\t// \t)\n\n\n\n\n\n\n\n\t\t// let result = await Promise.all(promises) as any[][]\n\t\t// let history = [].concat.apply([], result);\n\n\t\t// history = history\n\t\t// \t.map(item => {\n\t\t// \t\tconst rubric = rubrics.find(el => item['Рубрика'] && item['Рубрика'][0] === el.recID)\n\t\t// \t\tif (rubric) item.rubric = rubric['Название']\n\t\t// \t\treturn item\n\t\t// \t})\n\t\t// \t.sort((a, b) => {\n\t\t// \t\tvar dateA = new Date(a['Датавремя']),\n\t\t// \t\t\tdateB = new Date(b['Датавремя'])\n\t\t// \t\treturn dateB - dateA\n\t\t// \t})\n\n\n\t\t// this.setState({ history: history, isLoading: false })\n\n\n\n\t\t// }\n\n\t};\n\n\n\tcomponentWillUnmount() {\n\t\t// this._isMounted = false;\n\t}\n\n\n\n\tonStoryChange(e) {\n\t\tthis.setState({ activeStory: e.currentTarget.dataset.story })\n\t}\n\n\n\tcallVKApi(method: string, params?: any) {\n\t\tlet obj = { 'access_token': this.state.authToken, 'v': '5.87' }\n\t\tparams = !params ? obj : Object.assign(obj, params)\n\n\t\treturn connect.sendPromise(\"VKWebAppCallAPIMethod\", {\n\t\t\t'method': method,\n\t\t\t'params': params\n\t\t})\n\t}\n\n\n\tsetLocation = (route) => {\n\t\tif (route !== 'profile') {\n\t\t\tconnect.send('VKWebAppSetLocation', { location: route });\n\t\t} else {\n\t\t\tconnect.send('VKWebAppSetLocation', { location: '' });\n\t\t}\n\t}\n\n\tgo = async (e) => {\n\t\tconst route = e.currentTarget.dataset.to;\n\t\tconst meta = e.currentTarget.dataset.meta;\n\t\tconst parseMeta = meta ? JSON.parse(meta) : null\n\t\tif (parseMeta) this.setState({ meta: parseMeta })\n\n\t\tthis.setState({ activeView: route })\n\t\t// this.setLocation(route)\n\t};\n\n\n\tgetWallPost = async (query: string) => {\n\n\t\treturn connect.sendPromise('VKWebAppCallAPIMethod', {\n\t\t\tmethod: 'wall.search',\n\t\t\tparams: {\n\t\t\t\towner_id: -VK_GROUP_ID,\n\t\t\t\tquery: query,\n\t\t\t\tcount: 1,\n\t\t\t\taccess_token: this.state.authToken,\n\t\t\t\tv: '5.103'\n\t\t\t}\n\t\t}).then((res: any) => {\n\t\t\tlet post = res.response.items[0];\n\t\t\tpost.text = tp.execute(post.text);\n\t\t\treturn post;\n\t\t}).catch(_ => null)\n\n\n\t}\n\n\n\n\trender() {\n\t\tconst { fetchedUser, isLoading, history, sprintData, rubrics, items } = this.state;\n\t\tif (!fetchedUser || isLoading) return splashLoader;\n\n\t\treturn (\n\t\t\t\n\t\t\t<View id=\"main\" activePanel={this.state.activeView}>\n\t\t\t\t<Profile id=\"profile\" snackbar={this.state.snackbar} openSnackbar={this.openBase} market={items} rubrics={rubrics} go={this.go} fetchedUser={this.state.fetchedUser} history={history} sprintData={sprintData} ></Profile>\n\t\t\t\t<Rubric id=\"rubric\" user={this.state.fetchedUser} rubric={this.state.meta} post={this.state.post} go={this.go} history={history} sprintData={sprintData}></Rubric>\n\t\t\t\t<MarketCard id=\"marketItem\" go={this.go} item={this.state.meta}></MarketCard>\n\t\t\t\t<LessonCard id=\"lesson\" onBackClick={this.go} meta={this.state.meta} user={sprintData}></LessonCard>\n\t\t\t</View >\n\n\n\t\t)\n\t}\n}\n\n\nexport default App;\n\n","export const L_MEMBERS = 'Участники';\nexport const R_VK_ID = 'VK-ID';\nexport const R_NAME = 'Имя';\nexport const R_VK_COMMENTID = 'VK-CommentID';\nexport const R_PROFILE = 'Профиль';\nexport const R_RATE = 'Баллы';\nexport const R_COMMENT = 'Комментарий';\nexport const L_RATE_WORKOUT = 'Начисления: разминки';\nexport const L_RATE_SPRINT = 'Начисления: спринты';\nexport const L_RATE_SPAS = 'Начисления: дизайнспас';\nexport const L_RATE_WITHDRAW = 'Покупки';\nexport const RUBRICS = [L_RATE_SPAS, L_RATE_WORKOUT, L_RATE_SPRINT]","import 'core-js/features/map';\nimport 'core-js/features/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport connect from '@vkontakte/vk-connect';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK  Mini App\nconnect.send('VKWebAppInit');\n\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}