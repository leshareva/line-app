{"version":3,"sources":["img/splash.GIF","Airtable.ts","config.ts","components/Cover/Cover.tsx","components/Navbar/Navbar.tsx","components/Rubric/RubricTabs.tsx","components/Rubric/ScheduleListItem.tsx","components/Rubric/ScheduleList.tsx","icons.tsx","components/HistoryList.tsx","components/Helpers.ts","components/Rubric/Rubric.tsx","components/Profile/LevelBubble/LevelBubble.tsx","components/Profile/ProfileTabs.tsx","components/Profile/ToDoCardList.tsx","components/Profile/Profile.tsx","components/LessonCard/LessonCard.tsx","components/ProgressSnackbar/ProgressSnackBar.tsx","interfaces.tsx","components/ModalCardComponent.tsx","App.tsx","constants.tsx","index.tsx"],"names":["module","exports","base","Airtable","apikey","tLOGS","tUSERS","Cover","this","props","background","height","className","style","minHeight","children","React","Component","Navar","go","dataTo","meta","buttonColor","osname","platform","IOS","marginTop","left","onClick","data-to","data-meta","color","RubricTabs","rubric","history","onClickHandler","selectedTab","lessons","selected","length","ScheduleListItem","lesson","onCellClick","expandable","multiline","lessonID","recID","before","description","substring","ScheduleList","state","isLoading","Object","keys","map","key","i","les","header","replace","index","star","fill","width","viewBox","xmlns","d","logo","fillRule","clipRule","HistoryList","parseDate","iso","date","Date","month","getMonth","getDate","getFullYear","toLocaleTimeString","parseHistory","el","asideContent","mode","parseQueryString","require","string","slice","split","queryParam","kvp","value","reduce","query","Time","setHours","getHours","toTimeString","Rubric","_isMounted","purchases","activeTab","goods","getLessons","a","list","view","filterByFormula","then","res","obj","days","0","1","2","3","4","5","6","forEach","day","getDay","items","push","getPurchases","user","id","fields","catch","err","console","log","pursh","filter","renderAbonement","good","size","setState","fetchHistoryData","userID","rubricID","rubricTable","item","e","currentTarget","dataset","tabName","exp","current","next","title","Math","round","paddingLeft","source","LevelBubble","action","ProfileTabs","tabs","find","TodoCardsList","achieves","proms","achieve","fetchRubricHistory","userHistory","achievedItems","acivedItem","Promise","all","record","RubricID","error","openModal","cells","arr","type","data","desc","backgroundColor","textDecoration","separator","Profile","rubrics","openSnackbar","snackbar","top","ANDROID","src","photo_200","levelExperience","backTo","LessonCard","message","selectedFile","sendData","purchase","opt","toISOString","create","queryParams","window","location","search","vk_are_notifications_enabled","bridge","send","undo","_","href","listName","delete","checkPermissions","fetchRubric","fetchLessonData","onBackClick","formatTime","maxWidth","vertical","target","stretched","ProgressSnackBar","count","layout","onClose","rel","iUser","first_name","last_name","iAchieve","iRubric","iHistoryItem","ModalCardComponent","modalData","caption","actions","onButtonClickHandler","buttonLabel","body","tp","Typograf","locale","splashLoader","splash","alt","App","setLocation","route","activeView","onRubricCellClickHandler","activeModal","authToken","bind","setActiveModal","modal","subscribe","detail","fetchRubricsData","fetchUserData","userData","fetchUserPusrchases","air_schema","f_users","vk_id","experience","fetchAchieves","sl","toString","assign","hashParams","hash","r","access_token","t_users","undefined","name","f_history","points","comment","t_history","t_purchases","f_purchases","status","execute","sort","field","direction","maxRecords","concat","percent","activePanel","fetchLessons","rubricCellClickHandler","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.6a093098.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/splash.75e96a0e.GIF\";","import { AIR_CONFIG } from './config';\nimport Airtable from 'lean-air'\n\nexport const base = new Airtable(AIR_CONFIG);","//DEVELOPMENT\n// export const AIR_CONFIG = {\n//     apikey: 'keyCjoy0c7MaRyisi',\n//     base: 'appJJ0nmLtF6XYalJ',\n//     tLOGS: 'Начисления и списания',\n//     tUSERS: 'Участники'\n// }\n\n//PRODUCTION\nexport const AIR_CONFIG = {\n    apikey: 'keyCjoy0c7MaRyisi',\n    base: 'appEXq7BJ3ceoFRtr',\n    // base: 'apprhfMNTLVTiJC5A', //DEV\n    tLOGS: 'Начисления и списания',\n    tUSERS: 'Участники'\n}","import React from 'react';\nimport { Div } from '@vkontakte/vkui'\nimport './Cover.css'\n\nexport default class Cover extends React.Component<any, any> {\n\n\n    render() {\n\n        const {\n            background,\n            height\n        } = this.props\n        return (\n            <Div className=\"cover\" style={{ height: height ? height : '38vh', minHeight: '38vh', background: background ? background : 'linear-gradient(200.98deg, #485563 -13.11%, #29323C 75.28%)' }}>\n                {/* {(() => content)()} */}\n                <div className=\"coverContainer\">{this.props.children}</div>\n            </Div>\n        )\n    }\n}\n\n","import React from 'react'\nimport { PanelHeader, platform, IOS, PanelHeaderBack } from \"@vkontakte/vkui\";\n\n\nexport default class Navar extends React.Component<any, any> {\n    render() {\n        let { go, dataTo, meta, buttonColor} = this.props\n        const osname = platform();\n    \n        return (<PanelHeader className=\"navBar\" style={(() => osname === IOS ? {} : { marginTop: '81px' })()} left={<PanelHeaderBack onClick={go} data-to={dataTo} data-meta={meta} style={{color: buttonColor}}/>}>{this.props.children}</PanelHeader>)\n    }\n}","import React from 'react'\nimport { Tabs, TabsItem, HorizontalScroll } from '@vkontakte/vkui'\n\ninterface iRubricTabs {\n    rubric: any\n    history: any[]\n    lessons: any[]\n    onClickHandler: (tabName: string) => void\n    selectedTab: string\n}\n\nexport default class RubricTabs extends React.Component<iRubricTabs, any> {\n\n    render() {\n        let { rubric, history, onClickHandler, selectedTab, lessons } = this.props\n        \n        return <Tabs>\n            <HorizontalScroll>\n            {(lessons)\n                ?\n                <TabsItem\n                    onClick={() => onClickHandler('schedule')}\n                    selected={selectedTab === 'schedule'}\n                >Расписание</TabsItem>\n                : null\n\n            }\n\n\n\n            {(history && history.length !== 0)\n                ? <TabsItem\n                    onClick={() => onClickHandler('history')}\n                    selected={selectedTab === 'history'}\n                >Прогресс</TabsItem>\n                : null\n            }\n\n            {(rubric['Описание'])\n                ? <TabsItem\n                    onClick={() => onClickHandler('desc')}\n                    selected={selectedTab === 'desc'}\n                >О рубрике</TabsItem>\n                : null\n\n            }\n\n            </HorizontalScroll>\n            \n        </Tabs>\n    }\n}","import React from 'react'\nimport { Cell } from '@vkontakte/vkui'\n\ninterface iScheduleListItem {\n    lesson: any\n    onCellClick: (lesson: any) => void\n}\nexport default class ScheduleListItem extends React.Component<iScheduleListItem, any>{\n\n\n    render() {\n\n        let { lesson, onCellClick } = this.props\n        return <Cell\n            expandable\n            multiline\n            onClick={()=>onCellClick({ lessonID: lesson.recID })}\n            before={<div className=\"time\"></div>}\n            description={`${lesson['Время']} ${lesson['Описание'] ? ',' + lesson['Описание'].substring(0, 70) : ''}`}\n        >\n            {`${lesson['Name']}`}\n        </Cell>\n    }\n\n}","import React from 'react'\nimport { Group } from '@vkontakte/vkui'\nimport ScheduleListItem from './ScheduleListItem';\n\ninterface iScheduleList {\n    rubric: any\n    onCellClick: (meta: any) => void\n    lessons: any[]\n}\n\n\n\nexport default class ScheduleList extends React.Component<iScheduleList, any>{\n\n\n    constructor(props) {\n        super(props)\n        this.state = {\n            isLoading: true\n        }\n    }\n\n\n    render() {\n        let { lessons, onCellClick } = this.props\n        let days = Object.keys(lessons);\n        return days.map((key, i) => {\n            let les = lessons[key];\n            return <div className=\"calendarWrapper\" key={i}>\n                <Group header={<h1 className=\"calendarHeader\">{key.replace(/(\\d+\\s\\D{3}?).+/gs, '$1') + \", \" + les['day']}</h1>}  >\n                    {(() => {\n                        let less = lessons[key]['items']\n                        return less.map((lesson, index) => {\n                            return (<ScheduleListItem key={index} lesson={lesson} onCellClick={onCellClick} />)\n                        })\n                    })()}\n                </Group>\n            </div>\n        })\n\n\n\n    }\n}","import React from 'react';\n\nexport const star = (fill: string) => <svg width=\"24\" height=\"22\" viewBox=\"0 0 24 22\" xmlns=\"http://www.w3.org/2000/svg\" fill={fill}>\n<path d=\"M12 0L14.8214 8.11672L23.4127 8.2918L16.5651 13.4833L19.0534 21.7082L12 16.8L4.94658 21.7082L7.43493 13.4833L0.587322 8.2918L9.17863 8.11672L12 0Z\" />\n</svg>;\n\nexport const logo = <svg width=\"25\" height=\"24\" viewBox=\"0 0 25 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M15.2 2.6636L7.93161 18.2513H11.033C12.0258 18.2513 12.012 19.799 10.9916 19.799H6.74475C6.12427 19.799 5.8485 19.1496 6.0829 18.6383C6.26215 18.2582 6.43796 17.8782 6.61376 17.4982C6.78956 17.1182 6.96537 16.7382 7.14462 16.3581C9.61277 11.024 12.0671 5.70377 14.5215 0.383494L14.5215 0.383475C14.7559 -0.127825 15.6246 -0.127825 15.859 0.383475C16.0382 0.763482 16.214 1.14349 16.3898 1.5235C16.5656 1.90353 16.7414 2.28356 16.9207 2.6636C18.5971 6.29748 20.2799 9.93137 21.9648 13.5697C22.7467 15.2581 23.529 16.9475 24.3114 18.6383C24.5596 19.1496 24.27 19.799 23.6495 19.799H16.0244V23.2538C16.0244 24.2487 14.4801 24.2487 14.4801 23.2538V19.0252C14.4801 18.6106 14.8386 18.2513 15.2523 18.2513H22.4614L15.2 2.6636ZM24.4 1.4C24.4 0.626843 23.7731 1.11759e-08 23 1.11759e-08C22.2268 1.11759e-08 21.6 0.626843 21.6 1.4C21.6 2.17316 22.2268 2.8 23 2.8C23.7731 2.8 24.4 2.17316 24.4 1.4Z\" fill=\"white\" />\n</svg>","import React from 'react'\nimport { Header, Group, Cell, Div, List} from '@vkontakte/vkui'\nimport { star } from '../icons'\n\ninterface iHistoryList {\n    history: any[]\n}\nexport default class HistoryList extends React.Component<iHistoryList, any>{\n\n    parseDate = (iso: string) => {\n        var arr = [\n            'января',\n            'февраля',\n            'марта',\n            'апреля',\n            'мая',\n            'июня',\n            'июля',\n            'августа',\n            'сентября',\n            'октября',\n            'ноября',\n            'декабря',\n        ];\n        let date = new Date(iso)\n        let month = arr[+date.getMonth()];\n        const result = `${date.getDate()} ${month} ${date.getFullYear()}, ${date.toLocaleTimeString().replace(/(.*:.*?):\\d+/gs, '$1')}`\n        return result\n    }\n\n    private parseHistory = (history: any[]) => {\n\n        return history.map((el, i) => {\n            return <Cell key={i} asideContent={el.rubric} className={(() => (el['Баллы']) < 0 ? \"cellNegative\" : \"historyCell\")()} description={(() => {\n                return this.parseDate(el['Датавремя'])\n            })()\n            } >\n\n                {(() => {\n\n                    if (!el['Баллы']) el['Баллы'] = 0;\n\n                    if (el['Баллы'] > 0 && el['Опыт']) {\n                        return <span><span>{el['Баллы']}</span><span className=\"star\">{star('#000000')}</span><span>,&nbsp;{el['Опыт']}&nbsp;опыта {(() => el['Комментарий'] ? \"• \" + el['Комментарий'] : \"\")()}</span></span>\n                    } else if (el['Баллы'] === 0 && el['Опыт']) {\n                        return <span>{el['Опыт']}&nbsp;опыта {(() => el['Комментарий'] ? \"• \" + el['Комментарий'] : \"\")()}</span>\n\n                    } else if (!el['Опыт']) {\n                        return <span><span>{el['Баллы']}</span><span className=\"star\">{star('#000000')}</span>{(() => el['Комментарий'] ? \"• \" + el['Комментарий'] : \"\")()}</span>\n\n                    }\n                })()\n                }\n\n            </Cell>\n        })\n    }\n\n    render() {\n\n        let { history } = this.props\n\n        return <>\n            \n\n            <Group header={<Header mode=\"secondary\">Начисления</Header>} className=\"history\">\n                {(() => {\n                    if (history.length === 0) {\n                        return <Div>Вы пока не участвовали ни в одной активности в этой рубрике.</Div>\n                    }\n                    return <List> {this.parseHistory(history)} </List>\n                })()}\n\n            </Group>\n        </>\n\n\n    }\n\n}","const request = require(\"request\");\nconst fs = require(\"fs\"); // fs para escrever diretamente para o disco, much win\nconst path = require(\"path\");\n\n\nexport const parseQueryString = (string) => {\n    return string.slice(1).split('&')\n        .map((queryParam) => {\n            let kvp = queryParam.split('=');\n            return { key: kvp[0], value: kvp[1] }\n        })\n        .reduce((query, kvp) => {\n            query[kvp.key] = kvp.value;\n            return query\n        }, {})\n};\n\nexport const parseDate = (iso: string) => {\n    var arr = [\n        'января',\n        'февраля',\n        'марта',\n        'апреля',\n        'мая',\n        'июня',\n        'июля',\n        'августа',\n        'сентября',\n        'октября',\n        'ноября',\n        'декабря',\n    ];\n    let date = new Date(iso)\n    let month = arr[+date.getMonth()];\n    const result = `${date.getDate()} ${month} ${date.getFullYear()}, ${date.toLocaleTimeString().replace(/(.*:.*?):\\d+/gs, '$1')}`\n    return result\n}\n\nexport function Time(date) {\n    var d = new Date(date);\n    d.setHours(d.getHours());\n    let res = d.toTimeString().substring(0, 5);\n    return res;\n\n}\n\n\n\n\n\n\n//класс для сохранения и удаления файлов на сервер\n\nexport class Files {\n\n    constructor() { }\n\n    download(url, path_to, name): Promise<string | any> {\n        let p = new Promise(function (resolve, reject) {\n            let dest = path.join(path_to, name);\n            let writeStream = fs.createWriteStream(dest);\n\n            // Avisando a promise que acabamos por aqui\n            writeStream.on(\"finish\", function () {\n                resolve(dest as string);\n            });\n\n            // Capturando erros da write stream\n            writeStream.on(\"error\", function (err) {\n                fs.unlink(dest, reject.bind(null, err));\n            });\n\n            let readStream = request.get(url);\n\n            // Capturando erros da request stream\n            readStream.on(\"error\", function (err) {\n                fs.unlink(dest, reject.bind(null, err));\n            });\n\n            // Iniciando a transferência de dados\n            readStream.pipe(writeStream);\n        });\n\n        // Manter compatibilidade com callbacks\n        return p;\n\n        // p.then(function(id) {\n        //   callback(null, id);\n        // }).catch(function(err) {\n        //   callback(err);\n        // });\n    }\n\n    unlinkFile(path) {\n        fs.unlink(path, err => {\n            if (err) console.error(err.stack);\n            console.log(path + \" was deleted\");\n        });\n    }\n\n}\n","import React from 'react';\nimport { Panel, Div, Card, Group, Progress, InfoRow } from '@vkontakte/vkui';\nimport { base } from '../../Airtable';\nimport \"./Rubric.css\";\nimport Cover from '../Cover/Cover';\nimport ReactMarkdown from 'react-markdown';\nimport Navbar from '../Navbar/Navbar';\n\nimport RubricTabs from './RubricTabs';\nimport ScheduleList from './ScheduleList';\nimport HistoryList from '../HistoryList';\nimport { parseDate, Time } from '../Helpers';\n\n\ninterface iRubricPage {\n\tid: string\n\tuser: any\n\trubric: any\n\tgo: (route: string, meta?: any) => void\n\trubricCellClickHandler: (dataTo: string, metaData: any) => void\n}\n\n\nclass Rubric extends React.Component<iRubricPage, any> {\n\n\t_isMounted: boolean = false\n\n\tstate = {\n\t\tpurchases: null,\n\t\tlessons: null,\n\t\tactiveTab: null,\n\t\tgoods: null,\n\t\thistory: []\n\t}\n\n\n\n\tasync componentDidMount() {\n\t\tthis._isMounted = true\n\t\tlet { rubric } = this.props\n\t\tconst lessons = await this.getLessons()\n\n\t\tthis.setState({ lessons: lessons });\n\n\t\tlet history = await this.fetchHistoryData(this.props.user.id, rubric['recID'], rubric['Таблица'])\n\t\tlet purchases = await this.getPurchases()\n\t\tif(this._isMounted) {\n\t\t\tthis.setState({ history: history })\n\t\t\tif (lessons && Object.keys(lessons).length !== 0) {\n\t\t\t\tthis.setState({ activeTab: 'schedule' })\n\t\t\t} else if (history.length !== 0) {\n\t\t\t\tthis.setState({ activeTab: 'history' })\n\t\t\t} else {\n\t\t\t\tthis.setState({ activeTab: 'desc' })\n\t\t\t}\n\n\t\t\tthis.setState({ purchases:  purchases });\n\t\t}\n\t\t\n\t}\n\n\n\n\n\n\tcomponentWillUnmount() {\n\t\tthis._isMounted = false;\n\t}\n\n\n\n\n\n\tasync fetchHistoryData(userID: number, rubricID: string, rubricTable: string) {\n\t\treturn base.list(rubricTable, { filterByFormula: `AND({VK-ID} = ${userID}, NOT({Рубрика}=BLANK()))` }).then((history: any[]) => {\n\t\t\treturn history.filter(item => item['Рубрика'][0] === rubricID)\n\t\t}).catch(e => [])\n\t}\n\n\tgetLessons = async () => {\n\t\tif (!this.props.rubric) return;\n\n\t\treturn base.list('Тренировки', { view: 'Ближайшие', filterByFormula: `AND(NOT({Дата}=BLANK()), {RubricID}='${this.props.rubric.recID}')` })\n\t\t\t.then((res: any[]) => {\n\n\t\t\t\tif (res.length === 0) return\n\t\t\t\tlet obj = {}\n\n\n\t\t\t\tconst days = {\n\t\t\t\t\t0: 'вс',\n\t\t\t\t\t1: 'пн',\n\t\t\t\t\t2: 'вт',\n\t\t\t\t\t3: 'ср',\n\t\t\t\t\t4: 'чт',\n\t\t\t\t\t5: 'пт',\n\t\t\t\t\t6: 'сб'\n\t\t\t\t}\n\n\t\t\t\tres.forEach(el => {\n\t\t\t\t\tlet key = parseDate(el['Дата']).replace(/^(\\d+\\s.+?)\\s.+/gs, '$1');\n\t\t\t\t\tlet date = new Date(el['Дата']);\n\n\t\t\t\t\tobj[key] = {\n\t\t\t\t\t\tdate: key,\n\t\t\t\t\t\tday: days[date.getDay()],\n\t\t\t\t\t\titems: []\n\t\t\t\t\t}\n\n\n\t\t\t\t})\n\n\n\n\n\t\t\t\tres.forEach(el => {\n\t\t\t\t\tlet key = parseDate(el['Дата']).replace(/^(\\d+\\s.+?)\\s.+/gs, '$1');\n\t\t\t\t\tel['День недели'] = days[new Date(el['Дата']).getDay()]\n\t\t\t\t\tel['Время'] = Time(el['Дата'])\n\t\t\t\t\t// el['Окончание'] = Time(el['Время окончания'])\n\t\t\t\t\tel['Дата'] = key;\n\t\t\t\t\tel['rubric'] = this.props.rubric;\n\t\t\t\t\tobj[key]['items'].push(el)\n\t\t\t\t})\n\n\n\t\t\t\treturn obj\n\t\t\t})\n\t}\n\n\n\n\tselect(e) {\n\t\tconst mode = e.currentTarget.dataset.mode;\n\t\tthis.setState({ mode });\n\t}\n\n\n\n\n\n\tgetPurchases = async () => {\n\t\tconst user = this.props.user;\n\t\tconst rubric = this.props.rubric;\n\t\tlet res = await base.list('Покупки', { filterByFormula: `AND({VK-ID}=${user.id}, {Статус}=BLANK() )`, fields: [\"Название\", \"Рубрика\", \"Осталось\", \"Датавремя\", \"Кол-во тренировок\", \"Посещеные тренировки\"] }).catch(err => {\n\t\t\tconsole.log(err);\n\t\t\treturn [];\n\t\t}) as [];\n\n\t\tlet pursh = res.filter(el => el['Осталось'] && el['Рубрика'] && el['Рубрика'][0] === rubric.recID)\n\t\treturn pursh[0];\n\t}\n\n\trenderAbonement = () => {\n\n\t\tif (!this.state.goods) return;\n\n\t\treturn this.state.goods.map((good, i) => {\n\n\t\t\treturn <Card size=\"l\" key={i}>\n\t\t\t\t<div className=\"abonement\">\n\t\t\t\t\t<h2>{good[\"Название товара\"]}</h2>\n\t\t\t\t</div>\n\t\t\t</Card>\n\t\t})\n\t}\n\n\n\n\trender() {\n\n\t\tlet {\n\t\t\tgo,\n\t\t\trubric,\n\t\t} = this.props\n\n\n\n\t\t// const cover = () => rubric['Обложка'] ? `url(${rubric['Обложка'][0]['url']}) center/cover no-repeat` : '';\n\n\t\treturn (\n\n\t\t\t<Panel id='rubric'>\n\n\t\t\t\t<Navbar go={() => go('profile')} dataTo='profile'></Navbar>\n\n\t\t\t\t<Cover height=\"fit-content\">\n\t\t\t\t\t{/* <Cover background={cover()} height=\"fit-content\"> */}\n\t\t\t\t\t<Div className=\"desc\"><h1>{rubric['Название']}</h1></Div>\n\t\t\t\t</Cover>\n\n\n\t\t\t\t<RubricTabs\n\t\t\t\t\trubric={rubric}\n\t\t\t\t\tselectedTab={this.state.activeTab}\n\t\t\t\t\tlessons={this.state.lessons}\n\t\t\t\t\thistory={this.state.history}\n\t\t\t\t\tonClickHandler={(tabName) => this.setState({ activeTab: tabName })}\n\t\t\t\t/>\n\n\t\t\t\t{(() => {\n\t\t\t\t\tif (!rubric['Итог опыт'] || !this.state.history) return\n\n\t\t\t\t\tlet exp = this.state.history.filter(el => el['Опыт']).map(el => el['Опыт']).reduce((current, next) => current + next, 0);\n\t\t\t\t\treturn <Group title=\"Прогресс\" className=\"progressBarContainer\">\n\t\t\t\t\t\t<InfoRow header={`${Math.round((exp * 100) / rubric['Итог опыт'])}%`} className=\"progressBar\">\n\t\t\t\t\t\t\t<Progress value={(exp * 100) / rubric['Итог опыт']} style={{ width: '100%' }} />\n\t\t\t\t\t\t</InfoRow>\n\t\t\t\t\t</Group>\n\t\t\t\t})()}\n\n\t\t\t\t{(this.state.activeTab === 'desc' && rubric['Описание'])\n\t\t\t\t\t? <Div style={{ paddingLeft: 'var(--wrapper-padding-2x)' }}><ReactMarkdown source={rubric['Описание']} /> </Div>\n\t\t\t\t\t: ''\n\t\t\t\t}\n\n\n\n\t\t\t\t{(this.state.activeTab === 'history') ? <HistoryList history={this.state.history} /> : ''}\n\n\n\t\t\t\t{(() => {\n\t\t\t\t\tif (this.state.activeTab !== 'schedule') return;\n\t\t\t\t\treturn <ScheduleList\n\t\t\t\t\t\tlessons={this.state.lessons}\n\t\t\t\t\t\tonCellClick={(e) => this.props.go('lesson', e)}\n\t\t\t\t\t\trubric={rubric}\n\t\t\t\t\t/>\n\t\t\t\t})()}\n\n\t\t\t</Panel>\n\n\t\t);\n\t}\n}\n\n\nexport default Rubric;","import React from 'react';\nimport './LevelBubble.css'\n\nexport default class LevelBubble extends React.Component<any, any> {\n    render() {\n\n        let {\n            action\n        } = this.props\n\n        return (\n            <div className=\"levelBubble\" onClick={action}>{this.props.children}</div>\n        )\n    }\n}","import React from 'react'\nimport { Tabs, TabsItem, HorizontalScroll } from '@vkontakte/vkui'\n\ninterface iProfileTabs {\n    tabs: string[]\n    history: any[]\n    onClickHandler: (tabName: string) => void\n    selectedTab: string\n}\n\nexport default class ProfileTabs extends React.Component<iProfileTabs, any> {\n\n    render() {\n        let { history, onClickHandler, selectedTab, tabs } = this.props\n\n        if (!tabs||tabs.length === 0) return null\n\n        return <Tabs>\n            <HorizontalScroll>\n\n                {\n                    (() => {\n                        if (tabs.find(el => el === 'tasks')) {\n                            return <TabsItem\n                                onClick={() => onClickHandler('tasks')}\n                                selected={selectedTab === 'tasks'}\n                            >Задания</TabsItem>\n                        }\n                    })()\n                }\n\n                {\n                    (() => {\n                        if (tabs.find(el => el === 'rubrics')) {\n                            return <TabsItem\n                                onClick={() => onClickHandler('rubrics')}\n                                selected={selectedTab === 'rubrics'}\n                            >Рубрики</TabsItem>\n                        }\n                    })()\n                }\n\n\n\n\n\n                {(history && history.length !== 0 && tabs.find(el => el === 'history'))\n                    ? <TabsItem\n                        onClick={() => onClickHandler('history')}\n                        selected={selectedTab === 'history'}\n                    >Начисления</TabsItem>\n                    : null\n                }\n            </HorizontalScroll>\n        </Tabs>\n    }\n}","import React from 'react'\nimport { Group, Header, List, Cell, } from '@vkontakte/vkui';\nimport { iModalData, iUser, iAchieve } from '../../interfaces';\nimport { base } from '../../Airtable';\n\n\n\ninterface iTodoCardsList {\n    user: iUser\n    achieves: iAchieve[]\n    openModal: (modal: { type: string, data: iModalData }) => void\n}\n\nexport default class TodoCardsList extends React.Component<iTodoCardsList, any> {\n    _isMounted: boolean = false\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            achieves: null\n        }\n    }\n    async componentDidMount() {\n        this._isMounted = true\n        let proms = this.props.achieves.map(achieve => this.fetchRubricHistory(achieve).then((userHistory: any[]) => {\n\n            achieve.achievedItems = userHistory || []\n            let acivedItem = userHistory.filter(el => el['Ачивка']).find(el => el['Ачивка'][0] === achieve.recID)\n            achieve.acivedItem = acivedItem\n            return achieve\n        }))\n        if(this._isMounted) {\n            this.setState({\n                achieves: await Promise.all(proms)\n            })\n        }\n        \n    }\n\n    componentWillUnmount() {\n        this._isMounted = false;\n    }\n\n    async fetchRubricHistory(record: iAchieve) {\n\n        return base.list(record['Таблица'], {\n            filterByFormula: `AND(\n                {VK-ID}=${this.props.user.id}, \n                {Средняя} >= ${record['Оценка']}, \n                {RubricID}='${record.RubricID}',\n                NOT({Ачивка}=BLANK())\n                )`\n        })\n            .catch(e => {\n                console.error(e)\n                return []\n            })\n    }\n\n\n\n\n    render() {\n\n        let { achieves, openModal } = this.props\n\n        // const checkIfTaskDone = (task: any): boolean => {\n        //     if (!task['Участники']) return false\n        //     const id = task['Участники'].find(el => el === user.recID)\n        //     if (id) return true\n        //     return false\n        // }\n\n        const cells = (arr: iAchieve[]) => {\n            return arr.map((el, i) => {\n\n                return <Cell\n                    key={i}\n                    multiline\n                    onClick={() => openModal({\n                        type: 'modal',\n                        data: {\n                            title: el['Name'],\n                            desc: el['Описание'],\n                            // onButtonClickHandler: () => { console.log('Привет, мир!') },\n                            // body: (<Div>Вот мой прогресс</Div>)\n                        }\n                    })}\n                    data-to='lesson'\n\n                    before={<div className=\"roundContainer\">\n                        <div className=\"round\">\n                            <label className=\"roundCircle\" style={el.acivedItem ? { backgroundColor: 'var(--color-spacegray)' } : { backgroundColor: '#fff' }}></label>\n                        </div>\n                    </div>}\n\n                    description={!el.acivedItem ? `Выполнено ${el.achievedItems ? el.achievedItems.length : 0} из ${el[\"Кол-во работ\"]}` : `+ ${el.acivedItem['Опыт']} опыта`}\n                >\n                    <div style={el.acivedItem ? { textDecoration: 'line-through', color: 'var(--color-spacegray)' } : {}}>{`${el['Name']}`}</div>\n                </Cell>\n            })\n        }\n\n        return <Group header={<Header mode=\"secondary\">Цели</Header>} separator=\"hide\">\n\n            <List >\n                {cells(achieves.filter(el => !el.acivedItem).slice(0, 4))}\n                {cells(achieves.filter(el => el.acivedItem))}\n            </List>\n        </Group>\n    }\n}","import React from 'react'\n\nimport { Panel, Cell, List, PanelHeader, Group, Avatar, platform, ANDROID, Progress, Card, CardScroll, Header, Div } from '@vkontakte/vkui'\nimport Icon24BrowserForward from '@vkontakte/icons/dist/24/browser_forward'\nimport \"./Profile.css\"\nimport Cover from '../Cover/Cover'\nimport { star, logo } from '../../icons'\nimport LevelBubble from './LevelBubble/LevelBubble'\nimport ProfileTabs from './ProfileTabs'\nimport HistoryList from '../HistoryList'\nimport TodoCardsList from './ToDoCardList'\nimport { iModalData, iUser } from '../../interfaces'\n\n\n\ninterface iProfilePage {\n    id: string,\n    rubrics: any[]\n    go: (route: string, meta?: any) => void\n    user: iUser\n    snackbar: any\n    openSnackbar: () => void\n    history: any[]\n    achieves: any[]\n    openModal: (modal: { type: string, data: iModalData }) => void\n    getLessons: () => Promise<void | any[]>\n}\n\n\n\nclass Profile extends React.Component<iProfilePage, any> {\n\n    _isMounted: boolean = false\n\n    constructor(props) {\n        super(props)\n\n        this.state = {\n            tabs: ['rubrics', 'history'],\n            selectedTab: 'tasks',\n            lessons: []\n        }\n    }\n\n    async componentDidMount() {\n        this._isMounted = true\n\n        if (this.props.achieves && this.props.achieves.length !== 0) {\n            if (!this.state.selectedTab) this.setState({ selectedTab: 'tasks' })\n            let tabs = this.state.tabs\n            tabs.push('tasks')\n            this.setState({ tabs: tabs })\n        }\n        if (this._isMounted) {\n            let lessons = await this.props.getLessons();\n            this.setState({ lessons: lessons })\n        }\n    }\n\n    componentWillUnmount() {\n        this._isMounted = false;\n    }\n\n\n\n    render() {\n\n        let {\n            user,\n            go,\n            rubrics,\n            openSnackbar,\n            snackbar,\n            achieves,\n            openModal\n        } = this.props\n\n\n        let cardList = () => {\n            return (this.state.lessons && this.state.lessons.length !== 0)\n                ?\n                <Group header={<Header mode=\"secondary\">Участвуй сегодня</Header>} separator=\"hide\">\n                    <CardScroll>\n                        {(() => {\n                            return this.state.lessons.map(lesson => {\n                                //lesson['Обложка'] ? `url(${lesson['Обложка'][0]['url']})` :\n                                return <Card key={lesson.recID} style={{ color: 'white', background: 'linear-gradient(200.98deg, #485563 -13.11%, #29323C 75.28%)' }} size='m' onClick={() => go('lesson', { lessonID: lesson.recID, backTo: 'profile' })}><Div style={{ width: 144, height: 120 }} ><small>{lesson['Рубрика']}</small><br /><strong>{lesson['Name']}</strong><br /><small>+{lesson['Опыт']} опыта</small></Div></Card>\n                            })\n                        })()}\n                    </CardScroll>\n                </Group>\n                : null\n        }\n\n        return (\n\n            <Panel id='profile'  >\n                <PanelHeader></PanelHeader>\n                <Cover height=\"184px\">\n                    <div className=\"logo\" style={{ top: (platform() === ANDROID) ? '25px' : '37px' }}>{logo}</div>\n                    <div className=\"amountContainer\">\n                        <Avatar src={user.photo_200} size={72}></Avatar>\n                        <div className=\"amountWrapper\">\n                            <span className=\"amount\">{user['Баланс']}</span>\n                            <span className=\"star\">{star('#ffffff')}</span>\n                            <br />\n                            {`${1000 - user.levelExperience} опыта до ${Math.round(user['Уровень']) + 1} уровня `}\n                            <Progress value={user.levelExperience * 0.1} style={{ width: '100%' }} />\n                            {/* <a href=\"https://vk.com/@lean.school-kak-zarabotat-v-line-bally-i-zachem\" target=\"_blank\" rel=\"noopener noreferrer\">Зачем баллы?</a> */}\n                            <LevelBubble className=\"levelBubble\" action={openSnackbar}>{Math.round(user['Уровень'])}</LevelBubble>\n                        </div>\n\n                    </div>\n                </Cover>\n\n                <ProfileTabs tabs={this.state.tabs} history={this.props.history} selectedTab={this.state.selectedTab} onClickHandler={(tabName) => this.setState({ selectedTab: tabName })} />\n\n                {(() => {\n                    if (this.state.selectedTab !== 'tasks') return\n                    return <>\n                        {cardList()}\n                        <TodoCardsList achieves={achieves} openModal={openModal} user={user} />\n                    </>\n                })()}\n\n                {(() => {\n                    if (this.state.selectedTab === 'rubrics') {\n                        return <Group title=\"Рубрики\" >\n                            <List>\n                                {rubrics.map((rubric, i) => {\n                                    let cover = () => rubric['Обложка'] ? <Avatar mode=\"image\" src={rubric['Обложка'][0]['url']} size={72} /> : \"\"\n                                    return (<Cell\n                                        key={i}\n                                        before={cover()}\n                                        multiline\n                                        description={rubric['desc']}\n                                        asideContent={<Icon24BrowserForward fill=\"var(--icon_secondary)\" />}\n                                        onClick={(e) => go('rubric', rubric)}\n                                    >{rubric['Название']}</Cell>)\n                                })}\n                            </List>\n                        </Group>\n                    }\n                })()}\n\n\n                {(this.props.history.length !== 0 && this.state.selectedTab === 'history') ? <HistoryList history={this.props.history} /> : ''}\n                {snackbar}\n\n\n            </Panel>\n\n        )\n    }\n}\n\n\n\nexport default Profile","import React from 'react';\n\nimport { Panel, Div, FixedLayout, Separator, Button, Link, ANDROID, platform, FormLayout, File, Avatar, PopoutWrapper } from '@vkontakte/vkui';\nimport \"./LessonCard.css\";\nimport Cover from '../Cover/Cover';\nimport ReactMarkdown from 'react-markdown';\nimport bridge from '@vkontakte/vk-bridge';\nimport Navbar from '../Navbar/Navbar';\nimport { parseQueryString, parseDate, Time } from '../Helpers';\nimport { iUser } from '../../interfaces';\nimport { base } from '../../Airtable';\n\n\nconst osname = platform();\n\ninterface iLessonCard {\n\tid: string\n\tlessonID: string\n\tuser: iUser\n\tonBackClick: (route: string, meta?: any) => void\n\tbackTo?: string\n\tpurchases: any[]\n}\n\n\nclass LessonCard extends React.Component<iLessonCard, any> {\n\n\t_isMounted: boolean\n\tstate = { message: null, lesson: null, rubric: null, selectedFile: null }\n\n\tconstructor(props) {\n\t\tsuper(props)\n\t\tthis._isMounted = false;\n\t}\n\n\tasync componentDidMount() {\n\t\tthis._isMounted = true;\n\n\t\tawait this.fetchLessonData();\n\t\tif (this.state.lesson) this.checkPermissions();\n\t\t(osname === ANDROID) ? bridge.send(\"VKWebAppSetViewSettings\", { \"status_bar_style\": \"dark\", \"action_bar_color\": \"#ffffff\" }) : bridge.send(\"VKWebAppSetViewSettings\", { \"status_bar_style\": \"dark\", });\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis._isMounted = false;\n\t}\n\n\tasync fetchLessonData() {\n\t\tlet lessons = await base.list('Тренировки', { filterByFormula: `{recID}=\"${this.props.lessonID}\"` })\n\t\tif (!lessons[0]) return this.props.onBackClick('profile')\n\t\tlet lesson = this.formatTime(lessons[0]);\n\n\t\tlet rubric = await this.fetchRubric(lesson['RubricID'])\n\t\tif (this._isMounted) {\n\t\t\tthis.setState({ rubric: rubric, lesson: lesson })\n\t\t}\n\n\n\n\t\treturn\n\n\t}\n\n\n\tformatTime(el: any) {\n\t\tconst days = {\n\t\t\t0: 'вс',\n\t\t\t1: 'пн',\n\t\t\t2: 'вт',\n\t\t\t3: 'ср',\n\t\t\t4: 'чт',\n\t\t\t5: 'пт',\n\t\t\t6: 'сб'\n\t\t}\n\n\t\tlet key = parseDate(el['Дата']).replace(/^(\\d+\\s.+?)\\s.+/gs, '$1');\n\t\tel['День недели'] = days[new Date(el['Дата']).getDay()]\n\t\tel['Время'] = Time(el['Дата'])\n\t\tel['Дата'] = key;\n\t\treturn el\n\t}\n\n\tsendData = async () => {\n\t\t// let data = this.state.lesson;\n\t\tlet { rubric } = this.state\n\t\tlet { user, purchases, lessonID } = this.props\n\n\t\tlet purchase = purchases.find(el => el['Рубрика'].find(rubricID => rubricID === rubric.recID))\n\t\tlet opt = {\n\t\t\t\"Датавремя\": new Date().toISOString(),\n\t\t\t\"Профиль\": [user.recID],\n\t\t\t\"Баллы\": 1,\n\t\t\t\"Рубрика\": rubric.recID,\n\t\t\t\"Комментарий\": \"Запись на тренировку\",\n\t\t\t\"Покупки\": purchase ? [purchase.recID] : null,\n\t\t\t\"Тренировка\": [lessonID]\n\t\t}\n\n\t\tawait base.create(opt, rubric['Таблица']).then(res => {\n\t\t\tconst queryParams = parseQueryString(window.location.search);\n\t\t\tif (queryParams && queryParams.vk_are_notifications_enabled === \"0\") bridge.send(\"VKWebAppAllowNotifications\", {});\n\t\t\tthis.setState({\n\t\t\t\tmessage: (() => {\n\t\t\t\t\treturn <div>Вы записаны <Link onClick={() => this.undo(res, rubric['Таблица'])}>Отменить</Link></div>\n\t\t\t\t})()\n\t\t\t})\n\n\n\t\t}).catch(_ => this.setState({\n\t\t\tmessage: (() => {\n\t\t\t\treturn <div>Что-то сломалось. Напишите мне на <a href=\"mailto:reva@leandesign.pro\">reva@leandesign.pro</a></div>\n\t\t\t})()\n\t\t}))\n\n\t}\n\n\tundo = (obj, listName) => { base.delete([obj.recID], listName).then(res => this.setState({ message: null })).catch(console.log) }\n\n\n\tcheckPermissions = () => {\n\n\t\tlet { lesson, rubric } = this.state\n\n\t\t//есть ли у него абонемент?\n\t\tlet purchases = this.props.purchases || [];\n\n\t\tif (purchases.length === 0 && rubric['Товар']) return this.setState({ message: 'Для участия нужен абонемент' });\n\n\t\tif (!lesson['Участники']) return this.setState({ message: null })\n\n\t\tif (lesson['Осталось'] === 0) return this.setState({ message: 'Не осталось мест на тренировке' })\n\n\t\tif (this.props.user && !lesson['Ссылка'] && lesson['Участники'].find(el => +el === this.props.user['VK-ID'])) return this.setState({ message: '👍🏻 Ты в участниках' })\n\t\tif (this.props.user && lesson['Ссылка'] && lesson['Участники'].find(el => +el === this.props.user['VK-ID'])) return this.setState({ message: '👍🏻 Работа сдана' })\n\n\t}\n\n\tfetchRubric = (rubricID: string) => {\n\t\treturn base.find(rubricID, 'Рубрики')\n\t}\n\n\n\trender() {\n\n\t\tlet {\n\t\t\tonBackClick,\n\t\t\tid,\n\t\t\tuser,\n\t\t\tbackTo\n\t\t} = this.props\n\n\t\tlet { lesson, rubric } = this.state\n\n\n\t\tif (!lesson || !user) return <div id={id}>…</div>\n\t\tlet getImage = () => lesson['Обложка'] ? <Avatar src={lesson['Обложка'][0]['url']} mode=\"image\" size={80} /> : null\n\t\t\n\t\treturn (\n\n\t\t\t<Panel id={id}>\n\t\t\t\t<Navbar go={() => onBackClick(backTo ? backTo : 'rubric', rubric)} buttonColor=\"black\"></Navbar>\n\t\t\t\t<Cover background=\"#f2f2f2\" height='fit-content'>\n\t\t\t\t\t<Div style={{ maxWidth: '62vw', color: 'black' }}>\n\t\t\t\t\t\t<h1>{lesson['Name']}</h1>\n\t\t\t\t\t\t<div className=\"lead\">{`${lesson['Дата']}, ${lesson['День недели']}`} <br />\n\t\t\t\t\t\t\t{lesson['Время']}</div>\n\t\t\t\t\t</Div>\n\t\t\t\t</Cover>\n\t\t\t\t<Separator />\n\t\t\t\t<Div className=\"desc\">\n\t\t\t\t\t<ReactMarkdown source={lesson['Описание']} />\n\t\t\t\t\t{getImage()}\n\t\t\t\t</Div>\n\t\t\t\t<FixedLayout vertical=\"bottom\" className=\"bottomBar\" style={lesson['Участники'].find(el => +el === user['VK-ID']) ? { background: 'var(--color-spacegray)' } : {}}>\n\t\t\t\t\t{\n\t\t\t\t\t\t(() => {\n\t\t\t\t\t\t\tif (this.state.message) return <div>{this.state.message}</div>\n\t\t\t\t\t\t\treturn lesson['Ссылка'] ? <Button size={'l'} href={lesson['Ссылка']} target=\"_blank\" stretched={true}>Сдать работу</Button> : <Button size={'l'} stretched={true} onClick={() => this.sendData()}>Я буду</Button>\n\t\t\t\t\t\t})()\n\t\t\t\t\t}\n\n\t\t\t\t</FixedLayout>\n\t\t\t</Panel>\n\n\t\t);\n\t}\n}\n\n\n\nexport default LessonCard;","import React from 'react'\nimport { Snackbar, InfoRow, Progress } from '@vkontakte/vkui'\n\n\nexport class ProgressSnackBar extends React.Component<any, any> {\n\n    render() {\n        const { header, count } = this.props\n        return (\n            <Snackbar\n                className=\"snackbar\"\n                layout=\"vertical\"\n                onClose={() => {\n                    this.setState({ snackbar: null })\n                    return {}\n                }}\n            >\n                <InfoRow header={header}>\n                    <Progress value={count} style={{ width: '100%' }} />\n                </InfoRow>\n                <a href=\"https://vk.com/@lean.school-user-level\" target=\"_blank\" rel=\"noopener noreferrer\">Зачем нужен уровень?</a>\n\n            </Snackbar>\n        )\n    }\n\n}","//поля помеченные = null берутся из airtable. Остальные появлятся в коде.\n\nexport class iUser {\n\tid: number\n\tfirst_name: string\n\tlast_name: string\n\tlevelExperience?: number\n\t'Имя': string = null\n\t'VK-ID': number  = null\n\t'Баланс': number  = null\n\t'Опыт': number  = null\n\t'Уровень': number  = null\n\t'Email'?: string  = null\n\trecID: string\n\tphoto_200?: string\n}\n\nexport interface iModalData {\n\ttitle: string\n\tdesc: string\n\tonButtonClickHandler?: () => void\n\tbuttonLabel?: string\n\tbody?: any\n}\n\n\nexport class iAchieve {\n\trecID: string\n\t'Кол-во работ': number = null\n\t'RubricID': string = null\n\t'Name': string  = null\n\t'Описание': string = null\n\t'Оценка': number = null\n\t'Таблица': string = null\n\t'Короткое описание': string = null\n\t'Опубликовано': boolean = null\n\tachievedItems?: any[]\n\tacivedItem?: any\n}\n\nexport class iRubric {\n\trecID: string;\n\tdesc: string;\n\t'Название': string = null;\n\t'Опыт': number = null;\n\t'Таблица': string = null;\n\t'Обложка': any[] = null;\n\t'Описание': string = null;\n\t'ТэгЗадания': string = null;\n\t'Итог опыт': number = null;\n\t'Тренировки': string[] = null;\n}\n\n\nexport class iHistoryItem {\n\trecID: string\n\t'VK-ID': number = null\n\t'Датавремя': string = null\n\t'Профиль'?: string[] = null\n\t'Рубрика': string[] = null\n\t'Комментарий': string = null\n\t'Баллы': number = null\n\t'Средняя': number = null\n\t'Макет': any[] = null\n\t'Опыт': number = null\n}","import React from 'react'\nimport { ModalCard } from '@vkontakte/vkui'\nimport { iModalData } from '../interfaces'\n\ninterface iModalCardComponent {\n    id: string\n    onClose: (foo: any) => void\n    modalData: iModalData\n}\n\nexport default class ModalCardComponent extends React.Component<iModalCardComponent, any> {\n    render() {\n        let {modalData} = this.props\n        return <ModalCard\n            id={this.props.id}\n            onClose={() => this.props.onClose(null)}\n            header={modalData ? modalData.title : ''}\n            caption={modalData ? modalData.desc : ''}\n            actions={modalData && modalData.onButtonClickHandler ? [{\n                title: modalData ? modalData.buttonLabel : '',\n                mode: 'primary', action: () => modalData ? modalData.onButtonClickHandler : null\n            }] : []}\n        >\n            {modalData ? modalData.body : ''}\n        </ModalCard>\n    }\n}","import React from 'react';\nimport bridge from '@vkontakte/vk-bridge';\nimport { platform, ANDROID, View, ModalRoot } from '@vkontakte/vkui';\nimport * as Typograf from 'typograf';\nimport { air_schema } from 'lean-air';\nimport splash from './img/splash.GIF';\nimport '@vkontakte/vkui/dist/vkui.css';\nimport \"./main.css\";\nimport { AMOUNT_TO_NEW_USER, BASE_TRAIN, VIEW_TRAIN_UPCOMING } from './constants';\nimport Rubric from './components/Rubric/Rubric';\nimport Profile from './components/Profile/Profile';\nimport LessonCard from './components/LessonCard/LessonCard';\nimport { ProgressSnackBar } from './components/ProgressSnackbar/ProgressSnackBar';\nimport { iModalData, iUser, iRubric, iAchieve, iHistoryItem } from './interfaces';\nimport ModalCardComponent from './components/ModalCardComponent';\nimport { parseQueryString } from './components/Helpers';\nimport { base } from './Airtable';\n\n\n\n\nconst tp = new Typograf({ locale: ['ru', 'en-US'] });\n\nconst splashLoader = <div style={{ width: '100%', height: '100%', backgroundColor: '#770EFD' }}><img src={splash} style={{ width: '100%', height: '100%' }} alt=\"loading...\" /></div>;\n\nconst osname = platform();\n\n\ninterface iAppState {\n\tuser: iUser\n\tactiveView: string\n\tactiveModal: string\n\tmodalData: iModalData\n\tauthToken: string\n\tisLoading: boolean\n\thistory: any[]\n\trubrics: iRubric[]\n\tmeta: any\n\tsnackbar: any\n\tpurchases: any[]\n\tachieves: any[]\n}\n\nclass App extends React.Component<any, iAppState> {\n\n\t_isMounted: boolean\n\n\tconstructor(props) {\n\t\tsuper(props);\n\n\n\n\t\tthis.state = {\n\t\t\tuser: null,\n\t\t\tactiveView: null,\n\t\t\tactiveModal: null,\n\t\t\tmodalData: null,\n\t\t\tauthToken: null,\n\t\t\tisLoading: false,\n\t\t\thistory: [],\n\t\t\trubrics: [],\n\t\t\tmeta: {},\n\t\t\tsnackbar: null,\n\t\t\tpurchases: null,\n\t\t\tachieves: null\n\t\t};\n\n\t\tthis.openSnackbar = this.openSnackbar.bind(this);\n\t\tthis.setActiveModal = this.setActiveModal.bind(this);\n\t\tthis._isMounted = false\n\t}\n\n\n\n\tsetActiveModal(modal: { type: string, data: iModalData }) {\n\t\tlet activeModal = modal ? modal.type : null\n\t\tlet modalData = modal ? modal.data : null\n\t\tthis.setState({\n\t\t\tactiveModal,\n\t\t\tmodalData\n\t\t})\n\t}\n\n\n\n\tasync componentDidMount() {\n\n\t\tthis._isMounted = true;\n\n\t\tthis.setState({ isLoading: true })\n\n\t\tbridge.subscribe(async (e: any) => {\n\t\t\tswitch (e.detail.type) {\n\t\t\t\tcase 'VKWebAppGetUserInfoResult':\n\t\t\t\t\tlet rubrics = await this.fetchRubricsData()\n\t\t\t\t\tlet history = await this.fetchHistoryData(rubrics, e.detail.data)\n\t\t\t\t\tlet userData = await this.fetchUserData(e.detail.data);\n\t\t\t\t\tlet purchases = await this.fetchUserPusrchases(userData[air_schema.f_users.vk_id]);\n\t\t\t\t\tlet exp = Math.round(userData[air_schema.f_users.experience] ? userData[air_schema.f_users.experience] : 0);\n\t\t\t\t\tlet achieves = await this.fetchAchieves() as any[];\n\t\t\t\t\tlet sl = exp.toString()\n\t\t\t\t\tuserData.levelExperience = (sl.length > 3) ? +sl.slice(sl.length - 3) : +sl\n\n\n\n\t\t\t\t\tthis.setState({\n\t\t\t\t\t\trubrics: rubrics,\n\t\t\t\t\t\thistory: history,\n\t\t\t\t\t\tpurchases: purchases,\n\t\t\t\t\t\tuser: Object.assign(e.detail.data, userData),\n\t\t\t\t\t\tachieves: achieves\n\t\t\t\t\t})\n\n\t\t\t\t\tconst hashParams = parseQueryString(window.location.hash);\n\n\t\t\t\t\tif (hashParams.r === 'lesson' && hashParams.id) {\n\t\t\t\t\t\tthis.setState({ activeView: 'lesson', meta: { lessonID: hashParams.id }, isLoading: false })\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.setState({ activeView: 'profile', isLoading: false })\n\t\t\t\t\t}\n\n\n\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'VKWebAppAccessTokenReceived':\n\t\t\t\t\tthis.setState({ authToken: e.detail.data.access_token });\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'VKWebAppViewRestore':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'VKWebAppAllowNotificationsResult':\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\n\t\t\t}\n\t\t});\n\n\t\t(osname === ANDROID) ? bridge.send(\"VKWebAppSetViewSettings\", { \"status_bar_style\": \"light\", \"action_bar_color\": \"#000000\" }) : bridge.send(\"VKWebAppSetViewSettings\", { \"status_bar_style\": \"light\", });\n\t\tbridge.send('VKWebAppGetUserInfo', {});\n\n\t}\n\n\n\tcomponentWillUnmount() {\n\t\tthis._isMounted = false;\n\t}\n\n\n\n\tasync fetchUserData(user: iUser): Promise<iUser> {\n\t\tlet fields = new iUser() \n\t\tlet data: iUser\n\t\tdata = await base.list(air_schema.t_users, {\n\t\t\tfilterByFormula: `{${air_schema.f_users.vk_id}} = ${user.id}`, fields: Object.keys(fields).filter(key => fields[key] !== undefined)\n\t\t}).then(res => res[0]);\n\n\t\treturn data ? data : base.create({ [air_schema.f_users.name]: `${user.first_name} ${user.last_name}`, [air_schema.f_users.vk_id]: user.id }, air_schema.t_users)\n\t\t\t.then(res => base.create({\n\t\t\t\t[air_schema.f_history.points]: AMOUNT_TO_NEW_USER,\n\t\t\t\t[air_schema.f_history.user]: [res.recID],\n\t\t\t\t[air_schema.f_history.comment]: \"Первое начисление\"\n\t\t\t}, air_schema.t_history))\n\n\t}\n\n\tasync fetchUserPusrchases(userID: number): Promise<any> {\n\t\treturn base.list(air_schema.t_purchases, { filterByFormula: `AND({${air_schema.f_purchases.vk_id}}=${userID}, NOT({${air_schema.f_purchases.status}}=\"Архив\"))` })\n\t}\n\n\n\n\tasync fetchRubricsData(): Promise<iRubric[]> {\n\t\tlet fields = new iRubric();\n\n\t\tlet rubrics = await base.list('Рубрики', {\n\t\t\tfilterByFormula: '{Опубликовано} = TRUE()',\n\t\t\tfields: Object.keys(fields).filter(key => fields[key] !== undefined)\n\n\t\t}).catch(e => []) as iRubric[]\n\n\t\treturn rubrics.map((obj: iRubric) => {\n\t\t\tif (obj['Описание']) {\n\t\t\t\tobj['Описание'] = tp.execute(obj['Описание']);\n\t\t\t\tobj.desc = obj['Описание'].replace(/[*#|]/gs, '').slice(0, 60)\n\t\t\t\tif (obj.desc.length < obj['Описание'].length) obj.desc = obj.desc + \"…\"\n\t\t\t}\n\n\t\t\treturn obj\n\t\t}) as iRubric[];\n\n\t}\n\n\n\tfetchAchieves() {\n\t\tlet fields = new iAchieve();\n\t\treturn base.list('Ачивки', {\n\t\t\tsort: [{ field: 'Кол-во работ', direction: 'asc' }, { field: 'Сложность', direction: 'asc' }],\n\t\t\tfilterByFormula: 'NOT({Опубликовано}=BLANK())',\n\t\t\tfields: Object.keys(fields).filter(key => fields[key] !== undefined)\n\t\t}).catch(e => [])\n\t}\n\n\tasync fetchHistoryData(rubrics: any[], user: any) {\n\t\tlet fields = new iHistoryItem();\n\t\tlet proms = rubrics.map(rubric =>\n\t\t\tbase.list(\n\t\t\t\trubric['Таблица'],\n\t\t\t\t{\n\t\t\t\t\tview: 'Последний месяц',\n\t\t\t\t\tsort: [{ field: 'Датавремя', direction: 'desc' }],\n\t\t\t\t\tmaxRecords: 10,\n\t\t\t\t\tfilterByFormula: `{VK-ID} = ${user.id}`,\n\t\t\t\t\tfields: Object.keys(fields).filter(key => fields[key] !== undefined)\n\t\t\t\t})\n\t\t)\n\n\t\treturn Promise.all(proms).then((res: Array<[]>) => [].concat(...res))\n\t}\n\n\tasync fetchLessons() {\n\t\treturn base.list(BASE_TRAIN, { view: 'На главной в Линии' })\n\t}\n\n\n\t// onStoryChange = (e) => this.setState({ activeStory: e.currentTarget.dataset.story })\n\n\tsetLocation = (route: string) => {\n\t\tif (route !== 'profile') {\n\t\t\tbridge.send('VKWebAppSetLocation', { location: route });\n\t\t} else {\n\t\t\tbridge.send('VKWebAppSetLocation', { location: '' });\n\t\t}\n\t}\n\n\topenSnackbar() {\n\t\tif (this.state.snackbar) return;\n\t\tlet percent = this.state.user.levelExperience\n\t\tthis.setState({\n\t\t\tsnackbar: <ProgressSnackBar header={`${percent} / 1000 ед. опыта`} count={percent * 0.1} />\n\t\t});\n\t}\n\n\tgo = (route: string, meta?: any) => {\n\t\tif (meta) this.setState({ meta: meta })\n\t\tthis.setState({ activeView: route })\n\t\treturn\n\t};\n\n\t// go = async (route: string, meta: any) => {\n\t// \tconst route = e.currentTarget.dataset.to;\n\t// \tconst meta = e.currentTarget.dataset.meta;\n\t// \tconst parseMeta = meta ? JSON.parse(meta) : null\n\t// \tif (parseMeta) this.setState({ meta: parseMeta })\n\n\t// \tthis.setState({ activeView: route })\n\t// \treturn\n\t// };\n\n\tonRubricCellClickHandler = (route: string, meta: any) => {\n\t\tthis.setState({ activeView: route })\n\t\tthis.setState({ meta: meta })\n\t}\n\n\n\trender() {\n\n\t\tconst {\n\t\t\tuser,\n\t\t\tisLoading,\n\t\t\thistory,\n\t\t\trubrics,\n\t\t\tachieves,\n\t\t\tpurchases,\n\t\t\tmeta\n\t\t} = this.state;\n\n\t\tif (!user || isLoading) return splashLoader;\n\n\n\n\t\tconst modal =\n\t\t\t(<ModalRoot\n\t\t\t\tactiveModal={this.state.activeModal}\n\t\t\t\tonClose={() => this.setState({ activeModal: null })}\n\t\t\t>\n\n\t\t\t\t<ModalCardComponent\n\t\t\t\t\tid='modal'\n\t\t\t\t\tonClose={() => this.setActiveModal(null)}\n\t\t\t\t\tmodalData={this.state.modalData} />\n\n\t\t\t</ModalRoot>)\n\n\t\treturn (\n\t\t\t<View id=\"main\" activePanel={this.state.activeView} modal={modal}>\n\t\t\t\t<Profile\n\t\t\t\t\tid=\"profile\"\n\t\t\t\t\tsnackbar={this.state.snackbar}\n\t\t\t\t\topenSnackbar={this.openSnackbar}\n\t\t\t\t\trubrics={rubrics}\n\t\t\t\t\tgo={this.go}\n\t\t\t\t\tuser={user}\n\t\t\t\t\thistory={history}\n\t\t\t\t\tachieves={achieves}\n\t\t\t\t\topenModal={(modal) => this.setActiveModal(modal)}\n\t\t\t\t\tgetLessons={() => this.fetchLessons()}\n\t\t\t\t/>\n\t\t\t\t<Rubric\n\t\t\t\t\tid='rubric'\n\t\t\t\t\tuser={user}\n\t\t\t\t\trubric={meta}\n\t\t\t\t\tgo={this.go}\n\t\t\t\t\trubricCellClickHandler={this.go}\n\t\t\t\t/>\n\t\t\t\t<LessonCard\n\t\t\t\t\tid=\"lesson\"\n\t\t\t\t\tonBackClick={this.go}\n\t\t\t\t\tlessonID={meta.lessonID}\n\t\t\t\t\tuser={user}\n\t\t\t\t\tpurchases={purchases}\n\t\t\t\t\tbackTo={meta.backTo}\n\t\t\t\t/>\n\t\t\t</View >\n\t\t)\n\t}\n}\n\n\nexport default App;\n\n","export const AIRTABLE_APIKEY = 'keyCjoy0c7MaRyisi';\nexport const AIRTABLE_BASE = 'appEXq7BJ3ceoFRtr';\nexport const VK_APP_ID = 7215450; //prod\nexport const VK_GROUP_ID = 120547095; \nexport const VK_ADMIN_ACCESS_TOKEN = '25bec7da203afb629e05ec40bb284d3f196a85c0a0539b7cb428717a6a24782f883bd139e721167c775f3';\nexport const VK_SERVISE_KEY = 'f60c2422f60c2422f60c242263f6623d78ff60cf60c2422abd8f8acb1ae9af95c999324'//prod\n\n\nexport const AMOUNT_TO_NEW_USER = 25;\n\n\nexport const BASE_TRAIN = 'Тренировки';\nexport const VIEW_TRAIN_UPCOMING = 'Ближайшие';","import 'core-js/features/map';\nimport 'core-js/features/set';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport bridge from '@vkontakte/vk-bridge';\nimport App from './App';\n// import registerServiceWorker from './sw';\n\n// Init VK  Mini App\nbridge.send('VKWebAppInit');\n\n\n// Если вы хотите, чтобы ваше веб-приложение работало в оффлайне и загружалось быстрее,\n// расскомментируйте строку с registerServiceWorker();\n// Но не забывайте, что на данный момент у технологии есть достаточно подводных камней\n// Подробнее про сервис воркеры можно почитать тут — https://vk.cc/8MHpmT\n// registerServiceWorker();\n\nReactDOM.render(<App />, document.getElementById('root'));\n"],"sourceRoot":""}